<!doctypehtml><html lang="en"><meta charset="utf-8"><title>Yaksha Programming Language</title><link rel="apple-touch-icon"sizes="180x180"href="/apple-touch-icon.png"><link rel="icon"type="image/png"sizes="32x32"href="/favicon-32x32.png"><link rel="icon"type="image/png"sizes="16x16"href="/favicon-16x16.png"><link rel="manifest"href="/site.webmanifest"><link rel="mask-icon"href="/safari-pinned-tab.svg"color="#5bbad5"><meta name="msapplication-TileColor"content="#ffc7fd"><meta name="theme-color"content="#ffffff"><meta name="description"content="Yaksha Programming Language"><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@200&display=swap"rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap"rel="stylesheet"><link rel="stylesheet"href="/assets/style.min.css"id="theme-link"><div class="container"><div class="table-of-contents"><p>Pages<nav><a href="/">Home</a> <a href="/library-docs.html">Lib</a> <a href="/documentation.html">Docs</a></nav><button id="btn-toggle"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-brightness-high"viewBox="0 0 16 16"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg></button><div>&nbsp;</div><div class="real-toc"><div>&nbsp;</div><p>Table of Content<div class="toc-item"><a href="#how-does-it-work">[1] How does it work?</a></div><div class="toc-item"><a href="#let-s-look-at-the-sample-from-home-page">[1.1] Let&#x27;s look at the sample from home page</a></div><div class="toc-item"><a href="#input-code">[1.1.1] Input code</a></div><div class="toc-item"><a href="#output-c-code">[1.1.2] Output C code</a></div><div class="toc-item"><a href="#language-features">[2] Language Features</a></div><div class="toc-item"><a href="#data-types">[2.1] Data Types</a></div><div class="toc-item"><a href="#semi-managed-strings">[2.1.1] (Semi)Managed Strings</a></div><div class="toc-item"><a href="#string-literals">[2.1.2] String literals</a></div><div class="toc-item"><a href="#unmanaged-strings">[2.1.3] Unmanaged Strings</a></div><div class="toc-item"><a href="#string-view">[2.1.4] String View</a></div><div class="toc-item"><a href="#standard-integers">[2.1.5] Standard integers</a></div><div class="toc-item"><a href="#integer-types">[2.1.6] Integer types</a></div><div class="toc-item"><a href="#float-types">[2.1.7] Float types</a></div><div class="toc-item"><a href="#syntax-features">[2.2] Syntax features</a></div><div class="toc-item"><a href="#let-statement">[2.2.1] Let statement</a></div><div class="toc-item"><a href="#functions">[2.2.2] Functions</a></div><div class="toc-item"><a href="#basic-functions">[2.2.2.1] Basic functions</a></div><div class="toc-item"><a href="#exposing-c-library-functions">[2.2.2.2] Exposing C library functions</a></div><div class="toc-item"><a href="#template-functions">[2.2.2.3] Template functions</a></div><div class="toc-item"><a href="#gpu-opencl-device-functions">[2.2.2.4] GPU/OpenCL device functions</a></div><div class="toc-item"><a href="#defer-statement">[2.2.3] Defer statement</a></div><div class="toc-item"><a href="#del-statement">[2.2.4] Del statement</a></div><div class="toc-item"><a href="#class-statement">[2.2.5] Class statement</a></div><div class="toc-item"><a href="#creating-and-freeing-objects">[2.2.5.1] Creating and freeing objects</a></div><div class="toc-item"><a href="#exposing-native-structures">[2.2.5.2] Exposing native structures</a></div><div class="toc-item"><a href="#import-statement">[2.2.6] Import statement</a></div><div class="toc-item"><a href="#builtin-functions">[2.3] Builtin Functions</a></div><div class="toc-item"><a href="#non-primitive-data-types">[2.4] Non primitive data types</a></div><div class="toc-item"><a href="#dynamic-arrays">[2.4.1] Dynamic Arrays</a></div><div class="toc-item"><a href="#string-hash-map">[2.4.2] String Hash Map</a></div><div class="toc-item"><a href="#hash-map">[2.4.3] Hash Map</a></div><div class="toc-item"><a href="#hash-set">[2.4.4] Hash Set</a></div><div class="toc-item"><a href="#string-hash-set">[2.4.5] String Hash Set</a></div><div class="toc-item"><a href="#yaksha-library">[3] Yaksha library</a></div><div class="toc-item"><a href="#standard-library-components">[3.1] Standard Library Components</a></div><div class="toc-item"><a href="#core-library">[3.1.1] Core Library</a></div><div class="toc-item"><a href="#ui-library">[3.1.2] UI Library</a></div><div class="toc-item"><a href="#raylib-library">[3.1.3] Raylib Library</a></div><div class="toc-item"><a href="#cl-library">[3.1.4] CL Library</a></div><div class="toc-item"><a href="#how-does-the-yaksha-lang-library-get-packaged">[3.2] How does the Yaksha-lang library get packaged?</a></div><div class="toc-item"><a href="#packer-components">[3.2.1] Packer components</a></div><div class="toc-item"><a href="#third-party-libraries">[3.2.2] Third Party Libraries</a></div><div class="toc-item"><a href="#packer-dsl">[3.2.3] Packer DSL</a></div><div class="toc-item"><a href="#language-grammar">[4] Language Grammar</a></div><div class="toc-item"><a href="#statements">[4.1] Statements</a></div><div class="toc-item"><a href="#data-type">[4.2] Data Type</a></div><div class="toc-item"><a href="#expressions">[4.3] Expressions</a></div><div class="toc-item"><a href="#useful-utils">[4.4] Useful utils</a></div><div class="toc-item"><a href="#compiler-internals">[5] Compiler Internals</a></div><div class="toc-item"><a href="#phases-of-the-compiler">[5.1] Phases of the compiler</a></div><div class="toc-item"><a href="#tokenizer">[5.1.1] Tokenizer</a></div><div class="toc-item"><a href="#block-analyzer">[5.1.2] Block analyzer</a></div><div class="toc-item"><a href="#parser">[5.1.3] Parser</a></div><div class="toc-item"><a href="#import-analyzer">[5.1.4] Import analyzer</a></div><div class="toc-item"><a href="#def-struct-const-visitor">[5.1.5] Def-Struct-Const Visitor</a></div><div class="toc-item"><a href="#return-path-analyzer">[5.1.6] Return path analyzer</a></div><div class="toc-item"><a href="#type-checker">[5.1.7] Type checker</a></div><div class="toc-item"><a href="#template-compiler">[5.1.8] Template Compiler</a></div><div class="toc-item"><a href="#optimizer">[5.1.9] Optimizer</a></div><div class="toc-item"><a href="#to-cl-compiler">[5.1.10] To-CL-Compiler</a></div><div class="toc-item"><a href="#to-c-compiler">[5.1.11] To-C-Compiler</a></div><div class="toc-item"><a href="#c-to-c-compiler">[5.1.12] C-To-C Compiler</a></div></div></div><div class="boxes"><hr><div class="box"><div class="content"><div class="banner-image"><img alt="Yaksha Programming Language"src="images/yk-banner.png"style="max-width:100%"></div></div><div class="note"></div></div><div class="box"><div class="content"><h2 id="how-does-it-work">[1] How does it work?</h2><span class="timestamp">Created 2022-08-09, Last Updated 2022-08-10</span><h3 id="let-s-look-at-the-sample-from-home-page">[1.1] Let&#x27;s look at the sample from home page</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="input-code">[1.1.1] Input code</h4></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="o">+</span> <span class="n">b</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="output-c-code">[1.1.2] Output C code</h4></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="c1">// --yaksha header section--</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;yk__lib.h&quot;</span><span class="cp"></span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__factorial</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">);</span><span class="w"></span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__main</span><span class="p">();</span><span class="w"></span>
<span class="c1">// --yaksha body section--</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__factorial</span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">yy__x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">yy__x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">yy__x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">yy__factorial</span><span class="p">((</span><span class="n">yy__x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">yy__a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">yy__b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">yy__a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">yy__factorial</span><span class="p">(</span><span class="n">yy__a</span><span class="p">)));</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">t__1</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">yy__a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">yy__a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdscatsds</span><span class="p">(</span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__2</span><span class="p">),</span><span class="w"> </span><span class="n">yy__b</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">yy__b</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yy__b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__3</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__3</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">yy__b</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">t__4</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">yy__b</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// --yaksha footer section--</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">yy__main</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div></div><div class="note"><p>Notice <code>yk__sdsfree</code> is automatically generated for simple string uses. This makes strings immutable. Currently, it is doing a lot of unnecessary processing. üòì</div></div><div class="box"><div class="content"><hr><h2 id="language-features">[2] Language Features</h2><span class="timestamp">Created 2022-08-09, Last Updated 2022-08-10</span></div><div class="note"><hr></div></div><div class="box"><div class="content"><h3 id="data-types">[2.1] Data Types</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="semi-managed-strings">[2.1.1] (Semi)Managed Strings</h4><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>String allocations and de-allocations are abstracted away, so strings are immutable and automatically deleted.<li><p>Assignment copy values and automatically delete previous value.<li><p>Strings are also copied everytime you create a new variable or pass it to a function or assign it to a container (object, array, etc).<li><p>It is not meant to be fast. It is meant to be easily usable.<li><p>At C code level <code>yk__sds</code> data structure will be used. (<code>yk__sds</code> is a <code>char*</code> with special header placed just before).<li><p>üíÄÔ∏è Managed strings are not deleted when used in arrays, maps, or objects. (This is intentional and not a bug.)<ul><li><p>You need to manage deletion of <code>str</code> object in this case.<li><p>Use <code>libs.strings.array.del_str_array()</code> to delete a string array.</ul><li><p>Supports <code>+</code> operator to join two <code>str</code> values.</ul></div><div class="note"><p>Data Type - <code>str</code><p>Internally this is a binary string.<p><code>sds</code> library (part of runtime lib) takes care of the heavy lifting.</div></div><div class="box"><div class="content"><h4 id="string-literals">[2.1.2] String literals</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>String literals are of type <code>Const[strlit]</code>.</ul><div class="highlight"><pre><span></span><span class="c1"># String literals requires no deletion.</span>
<span class="n">a</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="n">strlit</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span>
<span class="c1"># Below results in a copy of string literal</span>
<span class="c1"># b will be auto deleted.</span>
<span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">a</span>
<span class="c1"># Below will create an unmanaged string from string literal</span>
<span class="c1"># This is also copied</span>
<span class="n">c</span><span class="p">:</span> <span class="n">ustr</span> <span class="o">=</span> <span class="n">a</span>
<span class="c1"># You need to however delete `c`</span>
<span class="k">del</span> <span class="n">c</span>
</pre></div><ul><li><p>Cannot be changed.<li><p>Only string datatype that can be used as a global constant.</ul></div><div class="note"><p>Data Type <code>Const[strlit]</code>.</div></div><div class="box"><div class="content"><h4 id="unmanaged-strings">[2.1.3] Unmanaged Strings</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Unmanaged strings need to be manually deleted using <code>del</code> expression.<li><p>At C code level <code>yk__sds</code> data structure will be used same as for <code>str</code><li><p>If you pass in an <code>str</code> for where <code>ustr</code> is expected, then original pointer is passed instead (no copy).<li><p>Always passes pointer instead of a copy.<li><p>Cannot copy by assignment.</ul></div><div class="note"><p>Data Type - <code>ustr</code><p>Internally this is a binary string.<p><code>sds</code> library (part of runtime lib) takes care of the heavy lifting.</div></div><div class="box"><div class="content"><h4 id="string-view">[2.1.4] String View</h4><p><span class="red-status">not started</span><span class="blue-status">planned for v0.2</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Idea of string view is to avoid duplicating strings.<li><p>Read only.<li><p>Let there be dragons, if referred string goes out of scope this will point to invalid memory.<li><p>If you assign a new value to the string, then string view is invalid as original string is freed. In this case <code>strvw</code> will refer to invalid memory.</ul></div><div class="note"><p>Data Type - <code>strvw</code></div></div><div class="box"><div class="content"><h4 id="standard-integers">[2.1.5] Standard integers</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Default integer is a 32bit signed integer.<li><p>This is compiled to <code>int32_t</code> on all platforms.</ul></div><div class="note"><p>Data Type - <code>int</code> or <code>i32</code></div></div><div class="box"><div class="content"><h4 id="integer-types">[2.1.6] Integer types</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Signed types - <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code><li><p>Unsigned types - <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code></ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="float-types">[2.1.7] Float types</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>f32</code> or <code>float</code> - single precision floats.</ul><ul><li><p><code>f64</code> - double precision floats.</ul></div><div class="note"><p>Data Type - <code>f32</code>, <code>float</code> and <code>f64</code></div></div><div class="box"><div class="content"><h3 id="syntax-features">[2.2] Syntax features</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="let-statement">[2.2.1] Let statement</h4><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Create a new variable.<li><p>If you want to assign to a variable, it needs to be created.<li><p>If no value is provided default value for data type is used.</ul></div><div class="note"><p>Default value for <code>str</code> is an empty string.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="functions">[2.2.2] Functions</h4></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="basic-functions">[2.2.2.1] Basic functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Has a return type if return type is <code>None</code> it will be converted to <code>void</code>.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="exposing-c-library-functions">[2.2.2.2] Exposing C library functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Useful to expose C library code.</ul><div class="highlight"><pre><span></span><span class="k">@native</span><span class="p">(</span><span class="s2">&quot;getarg&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">getarg</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div></div><div class="note"><p>Compiles to:<p><code>#define yy__getarg getarg</code><p>This is because all Yaksha lang identifiers are prefixed with <code>yy__</code> by default.</div></div><div class="box"><div class="content"><p>C macros can be created as explained below.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@native</span>
<span class="k">def</span> <span class="nf">getarg</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">ccode</span> <span class="s2">&quot;yk__sdsdup(global_args[yy__n])&quot;</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><p>If <code>ccode</code> is there instead of a pass statement, it compiles to a macro.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="cp">#define yy__getarg(yy_n) (yk__sdsdup(global_args[yy__n]))</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="template-functions">[2.2.2.3] Template functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Return type can also be a template-arg if that template-arg is used in parameters.<li><p>String passed inside <code>@template(</code> should be single upper case characters separated by commas.</ul></div><div class="note"><p>This means it is limited to 26 template arguments max.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__arrput&quot;</span><span class="p">)</span>
<span class="nd">@template</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">v</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__hmput&quot;</span><span class="p">)</span>
<span class="nd">@template</span><span class="p">(</span><span class="s2">&quot;K,V&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hmput</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__hmget&quot;</span><span class="p">)</span>
<span class="nd">@template</span><span class="p">(</span><span class="s2">&quot;K,V&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hmget</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="gpu-opencl-device-functions">[2.2.2.4] GPU/OpenCL device functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.5</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Easy access to GPU through OpenCL.</ul><div class="highlight"><pre><span></span><span class="k">@device</span>
<span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
   <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="defer-statement">[2.2.3] Defer statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Defer something to happen at the end of the scope.<li><p>Before any <code>return</code> from a function.<li><p>Before <code>break</code>, <code>continue</code> or end of <code>while</code> loop body.<ul><li><p>This behaviour is different from what you see in go-lang.</ul><li><p>Before end of <code>if</code> body or end of <code>else</code> body.<li><p>üíÄ Currently if you use <code>return some_function(a)</code> and deletion of <code>a</code> is deferred this will happen before calling, some_function. This is a bug that require fixing.</ul></div><div class="note"><p><code>defer</code> works as a stack.<p>That means deferred expressions are executed in last deferred first executed order.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">onexit</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;All done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">defer</span> <span class="n">onexit</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><p>Output:<div class="highlight"><pre><span></span>Hello World
All done
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="del-statement">[2.2.4] Del statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">In progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Delete values.<li><p>Delete arrays, and other builtin data structures without deleting content.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">a</span>
    <span class="n">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Compiles to <code>free</code> or other runtime functions.</div></div><div class="box"><div class="content"><h4 id="class-statement">[2.2.5] Class statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Create a custom data structure.<li><p>Generic structures are not supported yet.<li><p>Inheritance is not supported yet.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">student</span><span class="p">:</span>
    <span class="n">student_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">teacher</span><span class="p">:</span>
    <span class="n">teacher_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of student structure is &quot;</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="n">student</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="creating-and-freeing-objects">[2.2.5.1] Creating and freeing objects</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># Non primitive types are initialized to None</span>
    <span class="n">john</span><span class="p">:</span> <span class="n">student</span>
    <span class="c1"># Creating an instance, will be allocated in heap</span>
    <span class="c1"># Results in a malloc</span>
    <span class="n">john</span> <span class="o">=</span> <span class="n">student</span><span class="p">()</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span>
    <span class="c1"># Set fields</span>
    <span class="n">john</span><span class="o">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1"># str objects in structures are not freed automatically</span>
    <span class="n">john</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;John Smith&quot;</span>
    <span class="n">john</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;1 Road, Negombo&quot;</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span><span class="o">.</span><span class="n">name</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span><span class="o">.</span><span class="n">address</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><p>It might be better to create a custom function to delete custom objects.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">del_student</span><span class="p">(</span><span class="n">st</span><span class="p">:</span> <span class="n">student</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">name</span>
    <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">address</span>
    <span class="k">del</span> <span class="n">st</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">john</span><span class="p">:</span> <span class="n">student</span> <span class="o">=</span> <span class="n">student</span><span class="p">()</span>
    <span class="k">defer</span> <span class="n">del_student</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>

    <span class="n">john</span><span class="o">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">john</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;John Smith&quot;</span>
    <span class="n">john</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;1 Road, Negombo&quot;</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="exposing-native-structures">[2.2.5.2] Exposing native structures</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@native</span><span class="p">(</span><span class="s2">&quot;something&quot;</span><span class="p">)</span>
<span class="k">struct</span> <span class="nc">something</span><span class="p">:</span>
    <span class="n">something_id</span><span class="p">:</span> <span class="nb">int</span>
</pre></div></div><div class="note"><p>Compiles to<p><code>#define yy__something something</code></div></div><div class="box"><div class="content"><h4 id="import-statement">[2.2.6] Import statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Import a file.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;Haha&quot;</span><span class="p">)</span>
    <span class="k">defer</span> <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;-- failed to read file --&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readall</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;-- read file --&quot;</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Name mangling takes place for this.</div></div><div class="box"><div class="content"><h3 id="builtin-functions">[2.3] Builtin Functions</h3></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>‚úÖ <code>print</code> - A <code>print</code> function will be introduced instead of <code>print</code> statement.<li><p>‚úÖ <code>println</code> - A <code>print</code> function that suffix a new line character.<li><p>‚úÖ <code>len</code> - Get length of strings and other data structures provided by the language.<li><p>‚ùå <code>sizeof</code> - Size of structures or C data types.<li><p>‚ùå <code>slice</code> - Create a string view from a string with given start and end positions.<li><p>‚ùå <code>tostr</code> - Converts <code>strvw</code> or <code>int</code> types to string (base 10).<ul><li><p>If input is a <code>str</code>, <code>ustr</code> or <code>strvw</code> it is copied.<li><p><code>float</code> types will be formatted with 2 decimal places.</ul><li><p>‚ùå <code>toustr</code> - Same as <code>tostr</code> but it is converted to an unmanaged string.<li><p>‚ùå <code>ftostr</code> - Converts a <code>float</code> to <code>str</code> with given decimal points.<li><p>‚ùå <code>itostr</code> - Converts an <code>int</code> to <code>str</code> with given base up to 16.<li><p>‚ùå <code>ftoustr</code> - Converts a <code>float</code> to <code>ustr</code> with given decimal points.<li><p>‚ùå <code>itoustr</code> - Converts an <code>int</code> to <code>ustr</code> with given base up to 16.<li><p>‚úÖ <code>arrput</code> - Put item to an array.<li><p>‚úÖ <code>arrpop</code> - Remove last item from an array and return it.<li><p>‚ùå <code>arrfree</code> - Free an array. Used by <code>del</code>.<li><p>‚ùå <code>smput</code> - Put item to a StringHashMap.<li><p>‚ùå <code>smget</code> - Get item from a StringHashMap.<li><p>‚ùå <code>smfree</code> - Free StringHashMap and all string keys. Used by <code>del</code>.<li><p>‚ùå <code>reversed</code> - Reverse an array creating a new array. New array need to be deleted.<li><p>‚ùå <code>sorted</code> - Sort an array creating a new array. New array need to be deleted.</ul></div><div class="note"><p>Builtin functions may call different implementations in <code>C</code> based on input.</div></div><div class="box"><div class="content"><h3 id="non-primitive-data-types">[2.4] Non primitive data types</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>This section describes other essential types of builtin structures.</div><div class="note"></div></div><div class="box"><div class="content"><h4 id="dynamic-arrays">[2.4.1] Dynamic Arrays</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="n">i32</span><span class="p">]</span>
    <span class="c1"># Prior to calling arrput pointer is set to None</span>
    <span class="k">defer</span> <span class="n">arrfree</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Array access works with `[]`</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Must ensure array elements are freed. <code>int</code> need not be deleted as they are primitive types.</div></div><div class="box"><div class="content"><h4 id="string-hash-map">[2.4.2] String Hash Map</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>String hashmaps allow <code>mstr</code> keys and any <code>values</code>. Values need to be deleted when no longer needed.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">m</span><span class="p">:</span> <span class="nb">StringHashMap</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="k">defer</span> <span class="n">smfree</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">smput</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p><code>StringHashMap</code> keys are deleted automatically when <code>smfree</code> is invoked.<p><code>del</code> statement also acts as <code>smfree</code>.</div></div><div class="box"><div class="content"><h4 id="hash-map">[2.4.3] Hash Map</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Simple single key single value hashmaps.</div><div class="note"></div></div><div class="box"><div class="content"><h4 id="hash-set">[2.4.4] Hash Set</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.2</span></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="string-hash-set">[2.4.5] String Hash Set</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.2</span></div><div class="note"></div></div><div class="box"><div class="content"></div><div class="note"></div></div><div class="box"><div class="content"><hr><h2 id="yaksha-library">[3] Yaksha library</h2><span class="timestamp">Created 2022-08-09, Last Updated 2022-08-10</span></div><div class="note"><hr></div></div><div class="box"><div class="content"><p>Yaksha library uses multiple 3rd party libraries, set of python scripts and few other nuts and bolts to create library sources.</div><div class="note"></div></div><div class="box"><div class="content"><p>All exposed functionality starts with <code>yk__</code> or <code>YK__</code>. Yaksha programming language preserves anything that starts with <code>yk__</code> or <code>YK__</code> while prefixing any other name with <code>yy__</code>.</div><div class="note"><p>This avoids collisions with C standard library functions or keywords.</div></div><div class="box"><div class="content"><h3 id="standard-library-components">[3.1] Standard Library Components</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="core-library">[3.1.1] Core Library</h4><p><span class="yellow-status">in progress</span><p>Small core library with useful features.<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libs</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="ui-library">[3.1.2] UI Library</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Use nuklear+sokol to create UI applications.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ui</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="raylib-library">[3.1.3] Raylib Library</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Use raylib to build games and such</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">raylib</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="cl-library">[3.1.4] CL Library</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Access to OpenCL features and parallel programming.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cl</span>

<span class="k">@device</span>
<span class="k">def</span> <span class="nf">my_program</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">dvc</span><span class="p">:</span> <span class="n">cl</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dvc</span><span class="p">,</span> <span class="n">my_program</span><span class="p">)</span>
</pre></div></div><div class="note"><p>Placeholder code, API is not designed yet.</div></div><div class="box"><div class="content"><h3 id="how-does-the-yaksha-lang-library-get-packaged">[3.2] How does the Yaksha-lang library get packaged?</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="banner-image"><img alt="Yaksha Programming Language Runtime"src="images/yk-rt.png"style="max-width:100%"></div></div><div class="note"><p>Multiple sources are packaged into a single header file.<p>Library functionality is exposed by prefixing with <code>yk__</code> or <code>YK__</code>.</div></div><div class="box"><div class="content"><h4 id="packer-components">[3.2.1] Packer components</h4></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>packer.py</code> - Run packer DSL scripts and create packaged single header libraries.<li><p><code>inctree.py</code> - Topological sort <code>#include</code> DAG to determine best order for combining headers.</ul><ul><li><p><code>cids.exe</code> - Use <code>stb_c_lexer.h</code> library to parse C code and extract identifiers.<li><p><code>single_header_packer.py</code> - ApoorvaJ&#x27;s single header C code packager. <a href="https://github.com/ApoorvaJ/libs/blob/master/scripts/single_header_packer.py">Repo</a><li><p><code>python-patch</code> - techtonik&#x27;s patch script. <a href="https://github.com:techtonik/python-patch">Repo</a><li><p><code>fcpp</code>- Frexx C Preprocessor by Daniel Stenberg. (Patch for Windows compilation was needed, failed to compile with MSVC, works with MingW with patch).</ul></div><div class="note"><p>DAG - Directed Acyclic Graph.</div></div><div class="box"><div class="content"><h4 id="third-party-libraries">[3.2.2] Third Party Libraries</h4></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>sds</code> - Salvatore Sanfilippo&#x27;s string library. (Needed a patch to support MSVC 2019)<li><p><code>stb</code> - Single header libraries by Sean Barrett.<li><p><code>sokol</code> - Useful single header libraries by Andre Weissflog.<li><p><code>nuklear</code> - Single header immediate mode UI library by Micha Mettke.<li><p><code>libs</code> - Mattias Gustavsson&#x27;s single header C libraries.<li><p><code>utf8proc</code> - UTF-8 library - Jan Behrens, Public Software Group and Julia developers.</ul></div><div class="note"><p>If you stack few giants, you can stand very tall on top of them.</p><br><p>Note - currently only sds and stb_ds is used. This selection of libraries may change.</div></div><div class="box"><div class="content"><h4 id="packer-dsl">[3.2.3] Packer DSL</h4></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">use_source</span><span class="p">(</span><span class="s2">&quot;libs&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ini&quot;</span><span class="p">,</span> <span class="s2">&quot;thread&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">]:</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">extract_ids</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ids</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lib</span><span class="p">)]</span>
    <span class="n">PU</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ids</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
    <span class="n">prefix</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">prefix</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX_U</span><span class="p">,</span> <span class="n">PU</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;yk__http://&#39;</span><span class="p">),</span> <span class="s1">&#39;http://&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s2">&quot;YK__THREAD_PRIORITY_HIGHEST&quot;</span><span class="p">,</span> <span class="s2">&quot;THREAD_PRIORITY_HIGHEST&quot;</span><span class="p">]])</span>
    <span class="n">copy_file</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX</span> <span class="o">+</span> <span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">is_temp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">clang_format</span><span class="p">(</span><span class="n">PREFIX</span> <span class="o">+</span> <span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">is_temp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div></div><div class="note"><p>It is just Python 3.x with extra functions added and evaluated.ü§´</div></div><div class="box"><div class="content"><hr><h2 id="language-grammar">[4] Language Grammar</h2><span class="timestamp">Created 2022-08-09, Last Updated 2022-08-09</span><p>This describes Yaksha language grammar.<p>Lot learned from <code>Crafting Interpreters</code> book and Python grammar page.</div><div class="note"><hr></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><h3 id="statements">[4.1] Statements</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>This section describes statements and program structure. Program is made from one or more program statements. Standard statements are what goes inside functions.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">program</span><span class="p">:</span> <span class="n">import_statement</span><span class="o">*</span> <span class="n">program_declaration</span><span class="o">*</span>
<span class="n">program_declarations</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">const_statement</span>
    <span class="o">|</span> <span class="n">struct_statement</span>
    <span class="o">|</span> <span class="n">def_statement</span>
<span class="n">standard_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">compound_statement</span>
    <span class="o">|</span> <span class="n">simple_statement</span>
<span class="n">compound_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">if_statement</span>
    <span class="o">|</span> <span class="n">while_statement</span>
<span class="n">simple_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">let_statement</span>
    <span class="o">|</span> <span class="n">return_statement</span>
    <span class="o">|</span> <span class="n">defer_statement</span>
    <span class="o">|</span> <span class="s2">&quot;pass&quot;</span>
    <span class="o">|</span> <span class="s2">&quot;break&quot;</span>
    <span class="o">|</span> <span class="s2">&quot;continue&quot;</span>
    <span class="o">|</span> <span class="n">expr_statement</span>
    <span class="o">|</span> <span class="n">del_statement</span>
    <span class="o">|</span> <span class="n">c_code_statement</span>
<span class="c1"># Because defer can use del statement or any another expression.</span>
<span class="c1"># Del statement has two components with and without statement end.</span>
<span class="n">base_del_statement</span><span class="p">:</span> <span class="s2">&quot;del&quot;</span> <span class="n">expr</span>
<span class="n">del_statement</span><span class="p">:</span> <span class="n">base_del_statement</span> <span class="n">st_end</span>
<span class="c1"># Defer can use a del statement or an expr</span>
<span class="n">defer_statement</span><span class="p">:</span> <span class="s2">&quot;defer&quot;</span> <span class="p">(</span><span class="n">base_del_statement</span> <span class="o">|</span> <span class="n">expr</span><span class="p">)</span> <span class="n">st_end</span>
<span class="c1"># Functions</span>
<span class="n">def_statement</span><span class="p">:</span> <span class="n">annotation</span><span class="o">*</span> <span class="s2">&quot;def&quot;</span> <span class="n">name</span> <span class="s2">&quot;(&quot;</span> <span class="n">parameters</span><span class="err">?</span> <span class="s2">&quot;)&quot;</span> <span class="n">block</span> <span class="n">st_end</span>
<span class="c1"># Let statement creates variables</span>
<span class="n">let_statement</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">data_type</span> <span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="n">expr</span><span class="p">)</span><span class="err">?</span> <span class="n">st_end</span>
<span class="c1"># If statement</span>
<span class="n">if_statement</span><span class="p">:</span> <span class="s2">&quot;if&quot;</span> <span class="n">block</span> <span class="p">(</span><span class="s2">&quot;else&quot;</span> <span class="n">block</span><span class="p">)</span><span class="err">?</span>
<span class="c1"># While statement</span>
<span class="n">while_statement</span><span class="p">:</span> <span class="s2">&quot;while&quot;</span> <span class="n">block</span>
<span class="c1"># Custom data structures</span>
<span class="c1"># Struct value data types must be present</span>
<span class="n">struct_value</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">data_type</span> <span class="n">st_end</span>
<span class="n">struct_block</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span> <span class="n">newline</span> <span class="n">ba_indent</span> <span class="n">struct_value</span><span class="o">+</span> <span class="n">ba_dedent</span>
<span class="n">stuct_statement</span><span class="p">:</span> <span class="n">annotation</span><span class="o">*</span> <span class="s2">&quot;class&quot;</span> <span class="n">name</span> <span class="n">struct_block</span>
<span class="c1"># Expression statements, calling functions etc.</span>
<span class="n">expr_statement</span><span class="p">:</span> <span class="n">expr</span> <span class="n">st_end</span>
<span class="c1"># Return statement</span>
<span class="n">return_statement</span><span class="p">:</span> <span class="s2">&quot;return&quot;</span> <span class="n">expr</span> <span class="n">st_end</span>
<span class="c1"># Constants compiles to #defines.</span>
<span class="n">const_statement</span><span class="p">:</span> <span class="s2">&quot;const&quot;</span> <span class="n">name</span> <span class="s2">&quot;=&quot;</span> <span class="p">(</span><span class="n">number</span> <span class="o">|</span> <span class="n">string</span><span class="p">)</span>
<span class="c1"># Import statements include other source files and perform name mangling</span>
<span class="c1"># You need to always rename level 2+ imports</span>
<span class="n">import_statement</span><span class="p">:</span> <span class="s2">&quot;import&quot;</span> <span class="n">name</span> <span class="p">(</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="n">name</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;as&quot;</span> <span class="n">name</span> <span class="p">)</span><span class="err">?</span> <span class="n">st_end</span>
<span class="c1"># Dumps unmodified C code. It would be better to encapsulate these.</span>
<span class="c1"># When used with @native functions compiles to a c macro</span>
<span class="n">c_code_statement</span><span class="p">:</span> <span class="s2">&quot;ccode&quot;</span> <span class="p">(</span><span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span><span class="p">)</span> <span class="n">st_end</span>
<span class="c1"># Multiline or single simple statement blocks</span>
<span class="n">block</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span> <span class="p">(</span><span class="n">newline</span> <span class="n">ba_indent</span> <span class="n">standard_statement</span><span class="o">+</span> <span class="n">ba_dedent</span> <span class="o">|</span> <span class="n">simple_statement</span><span class="p">)</span>
</pre></div></div><div class="note"><p><code>defer</code> statement is special, it can take either a <code>del</code> statement or any expression.<p>This allows you to defer a <code>del</code>.</div></div><div class="box"><div class="content"><h3 id="data-type">[4.2] Data Type</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">data_type</span><span class="p">:</span> <span class="n">data_type_part</span> <span class="o">|</span> <span class="n">name</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="n">name</span><span class="p">)</span><span class="err">?</span> <span class="p">(</span><span class="s2">&quot;[&quot;</span> <span class="n">data_type_args</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="err">?</span>
<span class="n">data_type_args</span><span class="p">:</span> <span class="n">data_type</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">data_type</span><span class="p">)</span><span class="o">*</span>
<span class="n">data_type_part</span><span class="p">:</span> <span class="n">name</span> <span class="o">|</span> <span class="n">primitive_data_type</span>
<span class="n">primitive_data_type</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;i8&quot;</span> <span class="o">|</span> <span class="s2">&quot;i16&quot;</span> <span class="o">|</span> <span class="s2">&quot;i32&quot;</span> <span class="o">|</span> <span class="s2">&quot;i64&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;u8&quot;</span> <span class="o">|</span> <span class="s2">&quot;u16&quot;</span> <span class="o">|</span> <span class="s2">&quot;u32&quot;</span> <span class="o">|</span> <span class="s2">&quot;u64&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;f32&quot;</span> <span class="o">|</span> <span class="s2">&quot;f64&quot;</span>
</pre></div></div><div class="note"><p>Data type describes, primitives, custom data types and non primitives.</div></div><div class="box"><div class="content"><h3 id="expressions">[4.3] Expressions</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>Expressions are itsy bitsy pieces that make up parts of statements.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">expr</span><span class="p">:</span> <span class="n">assignment</span>
<span class="n">assignment</span><span class="p">:</span> <span class="p">(</span><span class="n">fncall</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="err">?</span> <span class="n">name</span> <span class="s2">&quot;=&quot;</span> <span class="n">assignment</span>
    <span class="o">|</span> <span class="n">logical_not</span><span class="p">;</span>
<span class="n">logical_not</span><span class="p">:</span> <span class="s2">&quot;not&quot;</span> <span class="n">logic_or</span>
<span class="n">logic_or</span><span class="p">:</span> <span class="n">logic_and</span> <span class="p">(</span><span class="s2">&quot;or&quot;</span> <span class="n">logic_and</span><span class="p">)</span><span class="o">*</span>
<span class="n">logic_and</span><span class="p">:</span> <span class="n">equality</span> <span class="p">(</span><span class="s2">&quot;and&quot;</span> <span class="n">equality</span><span class="p">)</span><span class="o">*</span>
<span class="n">equality</span><span class="p">:</span> <span class="n">comparision</span> <span class="p">((</span><span class="s2">&quot;!=&quot;</span> <span class="o">|</span> <span class="s2">&quot;==&quot;</span><span class="p">)</span> <span class="n">comparision</span><span class="p">)</span><span class="o">*</span>
<span class="n">comparision</span><span class="p">:</span> <span class="n">term</span> <span class="p">((</span><span class="s2">&quot;&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">)</span> <span class="n">term</span><span class="p">)</span><span class="o">*</span>
<span class="n">term</span><span class="p">:</span> <span class="n">factor</span> <span class="p">((</span><span class="s2">&quot;-&quot;</span> <span class="o">|</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span> <span class="n">factor</span><span class="p">)</span><span class="o">*</span>
<span class="n">factor</span><span class="p">:</span> <span class="n">unary</span> <span class="p">((</span><span class="s2">&quot;/&quot;</span> <span class="o">|</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="n">unary</span><span class="p">)</span><span class="o">*</span>
<span class="n">unary</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span> <span class="n">unary</span> <span class="o">|</span> <span class="n">fncall</span>
<span class="n">fncall</span><span class="p">:</span> <span class="n">primary</span> <span class="p">(</span> <span class="s2">&quot;(&quot;</span> <span class="n">arguments</span><span class="err">?</span> <span class="s2">&quot;)&quot;</span> <span class="o">|</span> <span class="s2">&quot;[&quot;</span> <span class="n">expr</span> <span class="s2">&quot;]&quot;</span> <span class="o">|</span> <span class="s2">&quot;.&quot;</span> <span class="n">name</span> <span class="p">)</span><span class="o">*</span>
<span class="n">primary</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span> <span class="o">|</span> <span class="s2">&quot;False&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span> <span class="o">|</span> <span class="n">number</span> <span class="o">|</span> <span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span> <span class="o">|</span> <span class="n">name</span> <span class="o">|</span>
          <span class="s2">&quot;(&quot;</span> <span class="n">expr</span> <span class="s2">&quot;)&quot;</span>
</pre></div></div><div class="note"><p>Based on <a href="https://craftinginterpreters.com/appendix-i.html">lox grammar</a> and <a href="https://www.mathcs.emory.edu/~valerie/courses/fall10/155/resources/op_precedence.html">Python operator precedence</a>.</div></div><div class="box"><div class="content"><h3 id="useful-utils">[4.4] Useful utils</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="c1"># Annotations are used to define types of functions or structures</span>
<span class="c1"># Currently only @device, @native and @generic annotations are available.</span>
<span class="c1"># Annotations may have a single string parameter.</span>
<span class="n">annotation</span><span class="p">:</span> <span class="s2">&quot;@&quot;</span> <span class="n">name</span> <span class="p">(</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span> <span class="p">)</span> <span class="s2">&quot;)&quot;</span> <span class="p">)</span> <span class="n">newline</span>
<span class="n">parameters</span><span class="p">:</span> <span class="n">parameter</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">parameter</span><span class="p">)</span><span class="o">*</span>
<span class="n">parameter</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">datatype</span>
<span class="n">st_end</span><span class="p">:</span> <span class="n">newline</span> <span class="o">|</span> <span class="n">eof</span>
<span class="n">newline</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">|</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<span class="n">eof</span><span class="p">:</span> <span class="s2">&quot;end of file&quot;</span>
<span class="n">ba_indent</span><span class="p">:</span> <span class="s2">&quot;increase in indentation&quot;</span>
<span class="n">ba_dedent</span><span class="p">:</span> <span class="s2">&quot;decrease is indentation&quot;</span>
</pre></div></div><div class="note"><p><code>ba_indent</code> and <code>ba_dedent</code> gets calculated before parsing in <code>block_analyzer</code> phase.</div></div><div class="box"><div class="content"><hr><h2 id="compiler-internals">[5] Compiler Internals</h2><span class="timestamp">Created 2022-08-09, Last Updated 2022-08-10</span></div><div class="note"><hr></div></div><div class="box"><div class="content"><p>This section describes how compiler works.</div><div class="note"><p>Total of <code>11</code> passes are planned for the compiler.</div></div><div class="box"><div class="content"><h3 id="phases-of-the-compiler">[5.1] Phases of the compiler</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="tokenizer">[5.1.1] Tokenizer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Tokenizer breaks down input to individual tokens and Identifies Keywords.<li><p>Parse numbers and strings and check if they are valid according to the grammar.</ul></div><div class="note"><p>If any error is detected at this point we still continue up to parser so we can identify maximum number of errors.</div></div><div class="box"><div class="content"><h4 id="block-analyzer">[5.1.2] Block analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Convert indentation to <code>ba_indent</code>, <code>ba_dedent</code> type tokens.<li><p>Remove comments.<li><p>Remove extra new lines.</ul></div><div class="note"><p>Only 2-spaces, 4-spaces or tab based indents are supported. Will try to guess indentation type.<p>Still continue to parser even after errors.</div></div><div class="box"><div class="content"><h4 id="parser">[5.1.3] Parser</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Parses tokens returned by block analyzer an AST.<li><p>AST is represented as a <code>std::vector</code> of <code>stmt*</code>.</ul></div><div class="note"><p>Any errors from previous stages and parsing stage is printed here and program will exit.</div></div><div class="box"><div class="content"><h4 id="import-analyzer">[5.1.4] Import analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><div class="banner-image"><img alt="Import Analyzer"src="images/yk-imports.png"style="max-width:100%"></div><ul><li><p>Analyzes imports.<li><p>Parses imported files.<ul><li><p>This step will use more instances of Tokenizer, Parser and Compiler objects.</ul><h4 id="def-struct-const-visitor">[5.1.5] Def-Struct-Const Visitor</h4></ul></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Visit <code>def</code> statements and collect functions to a map.<li><p>Visit <code>class</code> statements and collect structures to a map.<li><p>Visit global constants.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="return-path-analyzer">[5.1.6] Return path analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span><ul><li><p>Analyzes return paths.<li><p>Ensure all functions return.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="type-checker">[5.1.7] Type checker</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Type checker visits AST and check for invalid types.<li><p>Checks for undefined variables.<li><p>Checks for undefined functions.<li><p>Checks for undefined structures.<li><p>Check all return types are same as that of the encapsulating functions.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="template-compiler">[5.1.8] Template Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Rewrite @template to be normal functions based on what&#x27;s passed to them.<li><p>Rewrite <code>fncall</code> expressions to use newly created functions.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="optimizer">[5.1.9] Optimizer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Remove dead code.<li><p>Basic constant folding.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="to-cl-compiler">[5.1.10] To-CL-Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.5</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Convert <code>@device</code> code to OpenCL program code.<li><p>Copy necessary structures.<li><p>Check validity - no generics, no str, no allocations.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="to-c-compiler">[5.1.11] To-C-Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Writes <code>C</code> code from AST.<li><p>Do any simple optimizations.<li><p>Handle <code>defer</code> statements.<li><p>Handle <code>str</code> deletions.<li><p>Create <code>struct</code> and function declarations.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="c-to-c-compiler">[5.1.12] C-To-C Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>We generate code to a single <code>C</code> file which can then be further optimized.<li><p>Parse and optimize subset of generated <code>C</code> code.</ul></div><div class="note"></div></div></div></div><script>!function(){const s=document.querySelector("#btn-toggle"),t=document.querySelector("#theme-link"),e="jadogg.github.io/theme",a='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-brightness-high" viewBox="0 0 16 16">\n  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>\n</svg>',l='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">\n  <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>\n</svg>';var i=localStorage.getItem(e);"/assets/style.min.css"!==i&&"/assets/style.light.min.css"!==i||(t.href=i,s.innerHTML="/assets/style.min.css"===i?a:l),s.addEventListener("click",function(){"/assets/style.min.css"===t.getAttribute("href")?(t.href="/assets/style.light.min.css",localStorage.setItem(e,"/assets/style.light.min.css"),s.innerHTML=l):(t.href="/assets/style.min.css",localStorage.setItem(e,"/assets/style.min.css"),s.innerHTML=a)})}()</script>