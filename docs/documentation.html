<!doctypehtml><html lang="en"><meta charset="UTF-8"><title>Yaksha Programming Language</title><link rel="apple-touch-icon"sizes="180x180"href="/apple-touch-icon.png"><link rel="icon"type="image/png"sizes="32x32"href="/favicon-32x32.png"><link rel="icon"type="image/png"sizes="16x16"href="/favicon-16x16.png"><link rel="manifest"href="/site.webmanifest"><link rel="mask-icon"href="/safari-pinned-tab.svg"color="#5bbad5"><meta name="msapplication-TileColor"content="#ffc7fd"><meta name="theme-color"content="#ffffff"><meta name="description"content="Yaksha Programming Language"><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&family=Source+Code+Pro:wght@400;600;900&family=Ubuntu&display=swap"rel="stylesheet"><link rel="stylesheet"href="/assets/normalize.min.css"><link rel="stylesheet"href="/assets/medium-font.min.css"id="font-size-link"><link rel="stylesheet"href="/assets/style.light.min.css"id="theme-link"><link rel="stylesheet"href="/assets/printing.min.css"media="print"><div class="container"><div class="table-of-contents"><img id="yaksha-logo"alt="Yaksha Programming Language"src="images/yk-banner.png"style="max-width:100%;display:none"><p id="pages-text-toc">Pages<nav><a href="/">Home</a> <a href="/library-docs.html">Lib</a> <a href="/documentation.html">Docs</a> <a href="/tutorials.html">Tutorials</a> <a href="/demos.html">Demos</a> <a href="/yama.html">YAMA</a> <a href="/blog.html">(B)log</a></nav><button id="btn-toggle"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-brightness-high"viewBox="0 0 16 16"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg></button> <button id="btn-small-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 32 32"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button> <button id="btn-medium-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 24 24"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button> <button id="btn-large-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 16 16"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button><div>&nbsp;</div><div class="real-toc"><div>&nbsp;</div><p>Table of Contents<div class="toc-item"><a href="#language-features">Language Features</a></div><div class="toc-item"><a href="#data-types">&nbsp;Data Types</a></div><div class="toc-item"><a href="#wrapped-string-references">&nbsp;&nbsp;Wrapped String References</a></div><div class="toc-item"><a href="#string-literals">&nbsp;&nbsp;String literals</a></div><div class="toc-item"><a href="#semi-managed-strings">&nbsp;&nbsp;(Semi)Managed Strings</a></div><div class="toc-item"><a href="#standard-integers">&nbsp;&nbsp;Standard integers</a></div><div class="toc-item"><a href="#integer-types">&nbsp;&nbsp;Integer types</a></div><div class="toc-item"><a href="#float-types">&nbsp;&nbsp;Float types</a></div><div class="toc-item"><a href="#syntax-features">&nbsp;Syntax features</a></div><div class="toc-item"><a href="#let-statement">&nbsp;&nbsp;Let statement</a></div><div class="toc-item"><a href="#functions">&nbsp;&nbsp;Functions</a></div><div class="toc-item"><a href="#basic-functions">&nbsp;&nbsp;&nbsp;Basic functions</a></div><div class="toc-item"><a href="#exposing-c-functions">&nbsp;&nbsp;&nbsp;Exposing C functions</a></div><div class="toc-item"><a href="#template-functions">&nbsp;&nbsp;&nbsp;Template functions</a></div><div class="toc-item"><a href="#gpu-opencl-device-functions">&nbsp;&nbsp;&nbsp;GPU/OpenCL device functions</a></div><div class="toc-item"><a href="#defer-statement">&nbsp;&nbsp;Defer statement</a></div><div class="toc-item"><a href="#del-statement">&nbsp;&nbsp;Del statement</a></div><div class="toc-item"><a href="#class-statement">&nbsp;&nbsp;Class statement</a></div><div class="toc-item"><a href="#creating-and-freeing-objects">&nbsp;&nbsp;&nbsp;Creating and freeing objects</a></div><div class="toc-item"><a href="#exposing-native-structures">&nbsp;&nbsp;&nbsp;Exposing native structures</a></div><div class="toc-item"><a href="#import-statement">&nbsp;&nbsp;Import statement</a></div><div class="toc-item"><a href="#while-loop">&nbsp;&nbsp;While loop</a></div><div class="toc-item"><a href="#foreach-loop">&nbsp;&nbsp;Foreach loop</a></div><div class="toc-item"><a href="#endless-for-loop">&nbsp;&nbsp;Endless for loop</a></div><div class="toc-item"><a href="#c-for-loop">&nbsp;&nbsp;C-For loop</a></div><div class="toc-item"><a href="#builtin-functions">&nbsp;Builtin Functions</a></div><div class="toc-item"><a href="#non-primitive-data-types">&nbsp;Non primitive data types</a></div><div class="toc-item"><a href="#dynamic-arrays">&nbsp;&nbsp;Dynamic Arrays</a></div><div class="toc-item"><a href="#string-hash-map">&nbsp;&nbsp;String Hash Map</a></div><div class="toc-item"><a href="#hash-map">&nbsp;&nbsp;Hash Map</a></div><div class="toc-item"><a href="#macros-yakshalisp">&nbsp;Macros &amp; YakshaLisp</a></div><div class="toc-item"><a href="#philosophy">&nbsp;&nbsp;Philosophy?</a></div><div class="toc-item"><a href="#what-are-the-differences">&nbsp;&nbsp;&nbsp;What are the differences?</a></div><div class="toc-item"><a href="#builtin-functions-values-prelude">&nbsp;&nbsp;Builtin functions, values &amp; prelude</a></div><div class="toc-item"><a href="#macro-environments">&nbsp;&nbsp;Macro environments</a></div><div class="toc-item"><a href="#how-does-it-look-like">&nbsp;&nbsp;How does it look like</a></div><div class="toc-item"><a href="#yaksha-library">Yaksha library</a></div><div class="toc-item"><a href="#standard-library-components">&nbsp;Standard Library Components</a></div><div class="toc-item"><a href="#core-library">&nbsp;&nbsp;Core Library</a></div><div class="toc-item"><a href="#ui-library">&nbsp;&nbsp;UI Library</a></div><div class="toc-item"><a href="#raylib-graphics-game-audio-library">&nbsp;&nbsp;raylib - Graphics/Game/Audio Library</a></div><div class="toc-item"><a href="#cl-library">&nbsp;&nbsp;CL Library</a></div><div class="toc-item"><a href="#language-grammar">Language Grammar</a></div><div class="toc-item"><a href="#statements">&nbsp;Statements</a></div><div class="toc-item"><a href="#data-type">&nbsp;Data Type</a></div><div class="toc-item"><a href="#expressions">&nbsp;Expressions</a></div><div class="toc-item"><a href="#useful-utils">&nbsp;Useful utils</a></div><div class="toc-item"><a href="#compiler-internals">Compiler Internals</a></div><div class="toc-item"><a href="#what-happens-when-you-compile-a-yaka-file">&nbsp;What happens when you compile a <code>.yaka</code> file?</a></div><div class="toc-item"><a href="#let-s-look-at-a-sample">&nbsp;&nbsp;Let's look at a sample</a></div><div class="toc-item"><a href="#input-code">&nbsp;&nbsp;&nbsp;Input code</a></div><div class="toc-item"><a href="#output-c-code">&nbsp;&nbsp;&nbsp;Output C code</a></div><div class="toc-item"><a href="#phases-of-the-compiler">&nbsp;Phases of the compiler</a></div><div class="toc-item"><a href="#tokenizer">&nbsp;&nbsp;Tokenizer</a></div><div class="toc-item"><a href="#block-analyzer">&nbsp;&nbsp;Block analyzer</a></div><div class="toc-item"><a href="#parser">&nbsp;&nbsp;Parser</a></div><div class="toc-item"><a href="#import-analyzer">&nbsp;&nbsp;Import analyzer</a></div><div class="toc-item"><a href="#def-struct-const-visitor">&nbsp;&nbsp;Def-Struct-Const Visitor</a></div><div class="toc-item"><a href="#return-path-analyzer">&nbsp;&nbsp;Return path analyzer</a></div><div class="toc-item"><a href="#type-checker">&nbsp;&nbsp;Type checker</a></div><div class="toc-item"><a href="#template-compiler">&nbsp;&nbsp;Template Compiler</a></div><div class="toc-item"><a href="#optimizer">&nbsp;&nbsp;Optimizer</a></div><div class="toc-item"><a href="#to-cl-compiler">&nbsp;&nbsp;To-CL-Compiler</a></div><div class="toc-item"><a href="#to-c-compiler">&nbsp;&nbsp;To-C-Compiler</a></div><div class="toc-item"><a href="#c-to-c-compiler">&nbsp;&nbsp;C-To-C Compiler</a></div><div class="toc-item"><a href="#how-does-the-yaksha-lang-library-get-packaged">&nbsp;How does the Yaksha-lang library get packaged?</a></div><div class="toc-item"><a href="#packer-components">&nbsp;&nbsp;Packer components</a></div><div class="toc-item"><a href="#third-party-libraries">&nbsp;&nbsp;Third Party Libraries</a></div><div class="toc-item"><a href="#packer-dsl">&nbsp;&nbsp;Packer DSL</a></div></div></div><div class="boxes"><hr><div class="box"><div class="content"><div class="banner-image"><img alt="Yaksha Programming Language"src="images/yk-banner.png"style="max-width:100%"></div></div><div class="note"></div></div><div class="box"><div class="content"><h2 id="language-features">1 Language Features</h2><span class="timestamp">Created 2022-08-09, Last Updated 2023-09-03</span></div><div class="note"></div></div><div class="box"><div class="content"><h3 id="data-types">1.1 Data Types</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="wrapped-string-references">1.1.1 Wrapped String References</h4><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Wrapped string literals <code>sr</code> wraps multiple source strings in an uniform structure. There is no reason to delete a <code>sr</code> unless you want to de-allocate, referred data of the string.<p>You can add two <code>sr</code> using <code>+</code> operator. However, resulting value will be of type <code>str</code>, as memory allocation is required. It is recommended to use a string buffer for concatenating a string.<div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
<span class="n">b</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="c1"># Type of c would be str</span>
</pre></div><p>Type inference during creating a variable will create a value of <code>sr</code> type whenever <code>"string literal"</code> is used on RHS.<div class="highlight"><pre><span></span><span class="n">my_sr</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span>
<span class="n">another_sr</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="string-literals">1.1.2 String literals</h4><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Internally string literals such as <code>"hello world"</code> are neither <code>str</code> or <code>sr</code>. They utilize a hidden data type <code>:s:</code> for string literal.<p>String literals are efficient and does not require any additional memory allocation.<p>If you <code>+</code> two string literals that will be done at compile time.<p>String literals are automatically converted to <code>sr</code> or <code>str</code>.</div><div class="note"></div></div><div class="box"><div class="content"><h4 id="semi-managed-strings">1.1.3 (Semi)Managed Strings</h4><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>String allocations and de-allocations are abstracted away, so strings are immutable and automatically deleted.<li><p>Assignment copy values and automatically delete previous value.<li><p>Strings are also copied every time you create a new variable or pass it to a function or assign it to a container (object, array, etc).<li><p>It is not meant to be fast. It is meant to be easily usable.<li><p>At C code level <code>yk__sds</code> data structure will be used. (<code>yk__sds</code> is a <code>char*</code> with special header placed just before).<li><p>üíÄÔ∏è Managed strings are not deleted when used in arrays, maps, or objects. (This is intentional and not a bug.)<ul><li><p>You need to manage deletion of <code>str</code> object in this case.<li><p>Use <code>libs.strings.array.del_str_array()</code> to delete a string array.</ul><li><p>Supports <code>+</code> operator to join two <code>str</code> values.</ul><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hello world&quot;</span>
<span class="c1"># support -&gt; datatype ‚úÖ | literal ‚úÖ</span>
<span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div></div><div class="note"><p>Data Type - <code>str</code><p>Internally this is a binary string.<p><code>sds</code> library (part of runtime lib) takes care of the heavy lifting.</div></div><div class="box"><div class="content"><h4 id="standard-integers">1.1.4 Standard integers</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Default integer is a 32bit signed integer.<li><p>This is compiled to <code>int32_t</code> on all platforms.</ul><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>       <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Four =&quot;</span><span class="p">)</span>
<span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div></div><div class="note"><p>Data Type - <code>int</code> or <code>i32</code></div></div><div class="box"><div class="content"><h4 id="integer-types">1.1.5 Integer types</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Signed types - <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code><li><p>Unsigned types - <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code></ul><div class="highlight"><pre><span></span><span class="c1"># Default integer type is i32</span>
<span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">b</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="mi">2</span>       <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">c</span><span class="p">:</span> <span class="nb">i8</span> <span class="o">=</span> <span class="mi">3i8</span>      <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">d</span><span class="p">:</span> <span class="nb">i16</span> <span class="o">=</span> <span class="mi">4i16</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">e</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="mi">5i32</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">f</span><span class="p">:</span> <span class="nb">i64</span> <span class="o">=</span> <span class="mi">6i64</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>

<span class="c1"># Unsigned</span>
<span class="n">g</span><span class="p">:</span> <span class="nb">u8</span> <span class="o">=</span> <span class="mi">3u8</span>      <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">h</span><span class="p">:</span> <span class="nb">u16</span> <span class="o">=</span> <span class="mi">4u16</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">i</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="mi">4u32</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">j</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">5u64</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="float-types">1.1.6 Float types</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>f32</code> or <code>float</code> - single precision floats.</ul><ul><li><p><code>f64</code> - double precision floats.</ul><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="nb">f32</span> <span class="o">=</span> <span class="mf">1.0f</span>    <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">b</span><span class="p">:</span> <span class="nb">f64</span> <span class="o">=</span> <span class="mf">2.0</span>     <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
<span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0f</span>  <span class="c1"># datatype ‚úÖ | literal ‚úÖ</span>
</pre></div></div><div class="note"><p>Data Type - <code>f32</code>, <code>float</code> and <code>f64</code></div></div><div class="box"><div class="content"><h3 id="syntax-features">1.2 Syntax features</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="let-statement">1.2.1 Let statement</h4><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Create a new variable.<li><p>If you want to assign to a variable, it needs to be created.<li><p>If no value is provided default value for data type is used.</ul></div><div class="note"><p>Default value for <code>str</code> is an empty string.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="functions">1.2.2 Functions</h4></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="basic-functions">1.2.2.1 Basic functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Return type must be mentioned always.<li><p>If return type is <code>None</code> it means no data is returned. (<code>void</code> in C world.)</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="exposing-c-functions">1.2.2.2 Exposing C functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>üíÄ You can only call <code>@nativexxx</code> functions from normal functions.<li><p>üíÄ <code>@nativexxx</code> functions cannot call each other or normal functions.</ul></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><h6 id="native-native-functions">1.2.2.2.1 @native - native functions</h6></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@native</span><span class="p">(</span><span class="s2">&quot;getarg&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_arg</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">@native</span>
<span class="k">def</span> <span class="nf">get_global_arg</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">ccode</span> <span class="s2">&quot;yk__sdsdup(global_args[yy__n])&quot;</span>
</pre></div><details><summary>Click to see output C code</summary><div class="highlight"><pre><span></span><span class="n">yk__sds</span><span class="w"> </span><span class="nf">yy__get_arg</span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">nn__n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">getarg</span><span class="p">(</span><span class="n">nn__n</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="n">yk__sds</span><span class="w"> </span><span class="nf">yy__get_global_arg</span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">nn__n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">global_args</span><span class="p">[</span><span class="n">yy__n</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div></details></div><div class="note"><p>If <code>ccode</code> is there instead of an argument, then it is used as the message body.</div></div><div class="box"><div class="content"><h6 id="nativemacro-macros-with-arguments">1.2.2.2.2 @nativemacro - macros with arguments</h6></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@nativemacro</span>
<span class="k">def</span> <span class="nf">min_int</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">ccode</span> <span class="s2">&quot;((nn__a &lt; nn__b) ? nn__a : nn__b)&quot;</span>

<span class="k">@nativemacro</span><span class="p">(</span><span class="s2">&quot;((nn__a &gt; nn__b) ? nn__a : nn__b)&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">max_int</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div><details><summary>Click to see output C code</summary><div class="highlight"><pre><span></span><span class="cp">#define yy__min_int(nn__a, nn__b) ((nn__a &lt; nn__b) ? nn__a : nn__b)</span>
<span class="cp">#define yy__max_int(nn__a, nn__b) ((nn__a &gt; nn__b) ? nn__a : nn__b)</span>
</pre></div></details></div><div class="note"></div></div><div class="box"><div class="content"><h6 id="nativedefine-simple-define">1.2.2.2.3 @nativedefine - simple #define</h6></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@nativedefine</span><span class="p">(</span><span class="s2">&quot;banana&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">banana</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div><details><summary>Click to see output C code</summary><div class="highlight"><pre><span></span><span class="cp">#define yy__banana banana</span>
</pre></div></details></div><div class="note"></div></div><div class="box"><div class="content"><h6 id="varargs-variable-argument-functions">1.2.2.2.4 @varargs - variable argument functions</h6></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>üíÄ Can only be used with <code>@nativedefine</code>.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@nativedefine</span><span class="p">(</span><span class="s2">&quot;yk__newsdsarray&quot;</span><span class="p">)</span>
<span class="nd">@varargs</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">pass</span>
</pre></div><details><summary>Click to see output C code</summary><div class="highlight"><pre><span></span><span class="cp">#define yy__new yk__newsdsarray</span>
<span class="c1">// Assume that yk__newsdsarray is something like below</span>
<span class="c1">// yk__sds *yk__newsdsarray(size_t count, ...)</span>
</pre></div></details></div><div class="note"></div></div><div class="box"><div class="content"></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="template-functions">1.2.2.3 Template functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Return type can also be a template-arg if that template-arg is used in parameters.<li><p>String passed inside <code>@template(</code> should be single upper case characters separated by commas.</ul></div><div class="note"><p>This means it is limited to 26 template arguments max.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__arrput&quot;</span><span class="p">)</span>
<span class="k">@template</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">v</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__hmput&quot;</span><span class="p">)</span>
<span class="k">@template</span><span class="p">(</span><span class="s2">&quot;K,V&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hmput</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">@native</span><span class="p">(</span><span class="s2">&quot;yk__hmget&quot;</span><span class="p">)</span>
<span class="k">@template</span><span class="p">(</span><span class="s2">&quot;K,V&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hmget</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="gpu-opencl-device-functions">1.2.2.4 GPU/OpenCL device functions</h5></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.5</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Easy access to GPU through OpenCL.</ul><div class="highlight"><pre><span></span><span class="k">@device</span>
<span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
   <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="defer-statement">1.2.3 Defer statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Defer something to happen at the end of the scope.<li><p>Before any <code>return</code> from a function.<li><p>Before <code>break</code>, <code>continue</code> or end of <code>while</code> loop body.<ul><li><p>This behaviour is different from what you see in go-lang.</ul><li><p>Before end of <code>if</code> body or end of <code>else</code> body.</ul></div><div class="note"><p><code>defer</code> works as a stack.<p>That means deferred expressions are executed in last deferred first executed order.</div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">onexit</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;All done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">defer</span> <span class="n">onexit</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><p>Output:<div class="highlight"><pre><span></span>Hello World
All done
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="del-statement">1.2.4 Del statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">In progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Delete values.<li><p>Delete arrays, and other builtin data structures without deleting content.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">a</span>
    <span class="nb">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nb">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Compiles to <code>free</code> or other runtime functions.</div></div><div class="box"><div class="content"><h4 id="class-statement">1.2.5 Class statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Create a custom data structure.<li><p>üíÄ Templated structures are not supported yet.<li><p>üíÄ Inheritance is not supported yet.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Student</span><span class="p">:</span>
    <span class="n">student_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">Teacher</span><span class="p">:</span>
    <span class="n">teacher_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="creating-and-freeing-objects">1.2.5.1 Creating and freeing objects</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># Non primitive types are initialized to None</span>
    <span class="n">john</span><span class="p">:</span> <span class="n">Student</span>
    <span class="c1"># Creating an instance, will be allocated in heap</span>
    <span class="c1"># Results in a malloc</span>
    <span class="n">john</span> <span class="o">=</span> <span class="n">Student</span><span class="p">()</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span>
    <span class="c1"># Set fields</span>
    <span class="n">john</span><span class="o">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1"># str objects in structures are not freed automatically</span>
    <span class="n">john</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;John Smith&quot;</span>
    <span class="n">john</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;1 Road, Negombo&quot;</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span><span class="o">.</span><span class="n">name</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">john</span><span class="o">.</span><span class="n">address</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><p>It might be better to create a custom function to delete custom objects.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">del_student</span><span class="p">(</span><span class="n">st</span><span class="p">:</span> <span class="n">Student</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">name</span>
    <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">address</span>
    <span class="k">del</span> <span class="n">st</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">john</span><span class="p">:</span> <span class="n">Student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">()</span>
    <span class="k">defer</span> <span class="n">del_student</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>

    <span class="n">john</span><span class="o">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">john</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;John Smith&quot;</span>
    <span class="n">john</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;1 Road, Negombo&quot;</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="exposing-native-structures">1.2.5.2 Exposing native structures</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">@nativedefine</span><span class="p">(</span><span class="s2">&quot;something&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Something</span><span class="p">:</span>
    <span class="n">something_id</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># Use @dotaccess for purely stack allocated structs</span>
<span class="k">@nativedefine</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">)</span>
<span class="k">@dotaccess</span>
<span class="k">class</span> <span class="nc">Color</span><span class="p">:</span>
    <span class="n">r</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">g</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span>
</pre></div><details><summary>Click to see output C code</summary><div class="highlight"><pre><span></span><span class="cp">#define yy__Something something</span>
<span class="cp">#define yy__Color Color</span>
</pre></div></details></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="import-statement">1.2.6 Import statement</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Import a file.</ul></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;Haha&quot;</span><span class="p">)</span>
    <span class="k">defer</span> <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;-- failed to read file --&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readall</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="s2">&quot;-- read file --&quot;</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Name mangling takes place for this.</div></div><div class="box"><div class="content"><h4 id="while-loop">1.2.7 While loop</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Loop as long as the expression evaluates to <code>True</code>.<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="foreach-loop">1.2.8 Foreach loop</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>For each allow you to iterate each element of a given array.<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">e1</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="n">e1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">e2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)</span>
            <span class="nb">println</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">e1</span>
    <span class="k">del</span> <span class="n">e2</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="endless-for-loop">1.2.9 Endless for loop</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Endless for loop will iterate until break is executed.<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nb">println</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h4 id="c-for-loop">1.2.10 C-For loop</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Standard for loop from <code>C</code> family of languages.<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="s2">&quot;hello &quot;</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">b</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;xxx&quot;</span><span class="p">;</span> <span class="n">b</span> <span class="o">+=</span> <span class="n">c</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10i8</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2i8</span><span class="p">)):</span>
        <span class="nb">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Note that Yaksha allows omitting <code>return</code>, assuming last expression matches the return data type.<p>This is why <code>add</code> function does not have a return statement.</div></div><div class="box"><div class="content"><h3 id="builtin-functions">1.3 Builtin Functions</h3></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>‚úÖ <code>print(primitive) -&gt; None</code> - Print without a new line<li><p>‚úÖ <code>println(primitive) -&gt; None</code> - Print + new line<li><p>‚úÖ <code>len(Array[T]) -&gt; int</code> - Get length of arrays,maps<li><p>‚úÖ <code>arrput(Array[T], T) -&gt; None</code> - Put item to an array<li><p>‚úÖ <code>arrpop(Array[T]) -&gt; T</code> - Remove last item from an array and return it<li><p>‚úÖ <code>arrnew("T", int) -&gt; Array[T]</code> - Create a new array of given size. (Uninitialized elements)<li><p>‚úÖ <code>arrsetcap(Array[T], int) -&gt; None</code> - Set array capacity / grow memory. Does not affect length.<li><p>‚úÖ <code>arrsetlen(Array[T], int) -&gt; None</code> - Set array length. Each element will be an uninitialized element.<li><p>‚úÖ <code>array("T", T...) -&gt; Array[T]</code> - Create a new array from given elements<li><p>‚úÖ <code>getref(T) -&gt; Ptr[T]</code> - Get a pointer to given object<li><p>‚úÖ <code>unref(Ptr[T]) -&gt; T</code> - Dereference a pointer<li><p>‚úÖ <code>charat(str, int) -&gt; int</code> - Get a character at a specific location in string<li><p>‚úÖ <code>shnew(Array[SMEntry[T]]) -&gt; None</code> - Initialize <code>Array[SMEntry[T]]</code> object<li><p>‚úÖ <code>shput(Array[SMEntry[T]], str, T) -&gt; None</code> - Put item to an <code>Array[SMEntry[T]]</code><li><p>‚úÖ <code>shget(Array[SMEntry[T]], str) -&gt; T</code> - Get item from an <code>Array[SMEntry[T]]</code><li><p>‚úÖ <code>shgeti(Array[SMEntry[T]], str) -&gt; int</code> - Get item index from an <code>Array[SMEntry[T]]</code> (-1 if not found)<li><p>‚úÖ <code>hmnew(Array[MEntry[K,T]]) -&gt; None</code> - Initialize <code>Array[MEntry[K,T]]</code> object<li><p>‚úÖ <code>hmput(Array[MEntry[K,T]], K, T) -&gt; None</code> - Put item to an <code>Array[MEntry[K,T]]</code><li><p>‚úÖ <code>hmget(Array[MEntry[K,T]], K) -&gt; T</code> - Get item from an <code>Array[MEntry[K,T]]</code><li><p>‚úÖ <code>hmgeti(Array[MEntry[K,T]], K) -&gt; int</code> - Get item index from an <code>Array[MEntry[K,T]]</code> (-1 if not found)<li><p>‚úÖ <code>cast("T", X) -&gt; T</code> - Data type casting builtin<li><p>‚úÖ <code>qsort(Array[T],Function[In[Const[AnyPtrToConst],Const[AnyPtrToConst]],Out[int]]) -&gt; bool</code> - Sort an array, returns True if successful<li><p>‚úÖ <code>iif(bool, T, T) -&gt; T</code> - Ternary functionality<li><p>‚úÖ <code>foreach(Array[T],Function[In[T,V],Out[bool]],V) -&gt; bool</code> - For each element in array execute given function<li><p>‚úÖ <code>countif(Array[T],Function[In[T,V],Out[bool]],V) -&gt; int</code> - For each element in array count if function returns true<li><p>‚úÖ <code>filter(Array[T],Function[In[T,V],Out[bool]],V) -&gt; Array[T]</code> - Create a new array with filtered elements based on return value of given function<li><p>‚úÖ <code>map(Array[T],Function[In[T,V],Out[K]],V) -&gt; Array[K]</code> - Create a new array with result of given function<li><p>‚úÖ <code>binarydata("data") -&gt; Const[Ptr[Const[u8]]]</code> - Create constant binary data (must pass in a string literal). Returns <code>Const[Ptr[Const[u8]]]</code> that does not need to be deleted.<li><p>‚úÖ <code>make("T") -&gt; Ptr[T]</code> - Allocate a single object.<li><p>‚úÖ <code>inlinec("T", "code") -&gt; T</code> - Inline <code>C</code> code resulting in <code>T</code> data type. Example - <code>inlinec("int", "sizeof(char)")</code></ul></div><div class="note"><p>Builtin functions may call different implementations based on input.</div></div><div class="box"><div class="content"><h3 id="non-primitive-data-types">1.4 Non primitive data types</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>This section describes other essential types of builtin structures.</div><div class="note"></div></div><div class="box"><div class="content"><h4 id="dynamic-arrays">1.4.1 Dynamic Arrays</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">i32</span><span class="p">]</span>
    <span class="c1"># Prior to calling arrput pointer is set to None</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">a</span>
    <span class="nb">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">arrput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Array access works with `[]`</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"><p>Must ensure array elements are freed. <code>int</code> need not be deleted as they are primitive types.</div></div><div class="box"><div class="content"><h4 id="string-hash-map">1.4.2 String Hash Map</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p>HashMap with str keys and given data type values.<p>Values need to be deleted when no longer needed.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">m</span><span class="p">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">SMEntry</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
    <span class="c1"># shnew must be called before using the array as a String Hash Map</span>
    <span class="nb">shnew</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">defer</span> <span class="k">del</span> <span class="n">m</span>
    <span class="nb">shput</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">r</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">shget</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div></div><div class="note"><p><code>Array[SMEntry[?]]</code> keys are deleted automatically when <code>del</code> is invoked.<p><code>len</code> will give the total number of elements of the String Hash Map.</div></div><div class="box"><div class="content"><h4 id="hash-map">1.4.3 Hash Map</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Simple single key single value hashmaps.</div><div class="note"></div></div><div class="box"><div class="content"></div><div class="note"><p>Data type <code>Array[MEntry[K,T]]</code>.<p>key and value both need to be deleted.</div></div><div class="box"><div class="content"><h3 id="macros-yakshalisp">1.5 Macros &amp; YakshaLisp</h3></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">documentation - in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p>YakshaLisp macros are one of the most important features of Yaksha. You can think of it as an interpreted language that lives in Yaksha compiler.</div><div class="note"><p>Because that is what it is!</div></div><div class="box"><div class="content"><p>It has it's own built in functions, can use <code>import</code>, read/write files and even use <code>metamacro</code> directive to create quoted input functions(similar to <code>defun</code>, except input args are not evaluated and returns quoted output that is immediately evaluated). Has multiple data types (list, map, callable, string, expression). Support's q-expressions <code>{1 2 3}</code> (inspired by build-your-own-lisp's lisp dialect), and special forms. A simple mark and sweep garbage collector is used. Provides a mediocre REPL and ability to execute standalone lisp code using a command. Not only that, it also support reflection using builtin callables such as <code>this</code> and <code>parent</code> (which returns a mutable current or parent scope as a map).</div><div class="note"><p>Yo dog!, I heard you like macros, so I added meta-macro support in your macro processor.<p>So you can meta-program while you meta-program.</div></div><div class="box"><div class="content"><h4 id="philosophy">1.5.1 Philosophy?</h4><p>YakshaLisp provide the ability to write token-list to token-list conversion macros. One can use <code>my_macro!{t t t}</code> style expansion to achieve this. So why YakshaLisp? because it needs to process a list of tokens.<p>Additionally, Yaksha and YakshaLisp are polar opposites of each other, therefore I think they can compliment each other nicely.</div><div class="note"><p>Think Yin-Yang!</div></div><div class="box"><div class="content"><h5 id="what-are-the-differences">1.5.1.1 What are the differences?</h5><table><p></p><caption>Language differences<p></p><thead><tr><th scope="col">Yaksha<th scope="col">YakshaLisp<th scope="col">C99<tbody><tr><td data-label="Yaksha">manual memory management<td data-label="YakshaLisp">garbage collected<td data-label="C99">manual memory management<tr><td data-label="Yaksha">compiled (to C99)<td data-label="YakshaLisp">interpreted<td data-label="C99">compiled by most compilers to target platform.<tr><td data-label="Yaksha">can be multi-threaded<td data-label="YakshaLisp">only single threaded<td data-label="C99">can be multi-threaded, etc<tr><td data-label="Yaksha">indent based syntax<td data-label="YakshaLisp">parenthesis based syntax<td data-label="C99">C family {} scope syntax<tr><td data-label="Yaksha">c-like function pointers<td data-label="YakshaLisp">closures, function body not evaluated unless called. First class functions/lambda<td data-label="C99">function pointers<tr><td data-label="Yaksha">multiple integer types and float / double / bool<td data-label="YakshaLisp">only 64bit signed integer is supported.<td data-label="C99">multiple integer types and float / double / bool, enums & unions<tr><td data-label="Yaksha">hygienic macros using $name syntax (automated gensym), non-hygienic macros are also supported (do not use the $ prefix for identifiers), can also generate C style macros/code with nativexxx annotations and ccode keyword in some cases.<td data-label="YakshaLisp">metamacro / eval / parse / this / parent / q-expressions<td data-label="C99">#define / #include<tr><td data-label="Yaksha">has statements and expressions<td data-label="YakshaLisp">expressions only<td data-label="C99">has statements and expressions<tr><td data-label="Yaksha">no support for exceptions<td data-label="YakshaLisp">exceptions are a string that you can throw and catch<td data-label="C99">setjmp<tr><td data-label="Yaksha">no support for reflection<td data-label="YakshaLisp">supports reflection - repr / this / parent<td data-label="C99">no support for reflection</tbody><p></table><p></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="builtin-functions-values-prelude">1.5.2 Builtin functions, values &amp; prelude</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="green-status">done</span></div><div class="note"></div></div><div class="box"><div class="content"><p>All below listed functions are available at the moment.</div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>nil</code> - this has value of <code>{}</code> (an empty list)<li><p><code>true</code> - value of <code>1</code><li><p><code>false</code> - value of <code>0</code><li><p><code>newline</code> - value of <code>\r\n</code> or <code>\n</code> as a string.<li><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>modulo</code> - basic functions<li><p><code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code> - comparison functions<li><p><code>and</code>, <code>or</code>, <code>not</code> - boolean operator functions<li><p><code>bitwise_and</code>, <code>bitwise_or</code>, <code>bitwise_not</code>, <code>bitwise_xor</code>, <code>bitwise_left_shift</code>, <code>bitwise_right_shift</code> - bitwise operator functions to be applied to number values (underlying structure of a number is a 64bit signed integer)<li><p><code>filter</code>, <code>map</code>, <code>reduce</code> - basic functional-programming functions<li><p><code>map_get</code>, <code>map_has</code>, <code>map_set</code>, <code>map_remove</code>, <code>map_values</code>, <code>map_keys</code> - functions to manipulate map-objects.<li><p><code>access_module</code> - access an element from another root environment (uses same imports at the top of the file as in Yaksha)<li><p><code>this</code>, <code>parent</code> - returns current scope or parent scope as a map-object (can be modified)<li><p><code>magic_dot</code> - wrapper around <code>map_get</code> and <code>access_module</code> (supports both type of objects) to read a value. Special syntax sugar <code>symbol1::symbol2</code> expands to <code>(magic_dot symbol1 symbol2)</code><li><p><code>io_read_file</code>, <code>io_write_file</code>, <code>print</code>, <code>println</code>, <code>input</code> - I/O functions<li><p><code>def/define</code> - define an undefined value in current environment with a given symbol.<li><p><code>setq</code> - update an already defined value<li><p><code>=</code> - combination of <code>setq</code> and <code>def</code>. try to <code>def</code> and if it fails use <code>setq</code>.<li><p><code>quote</code> - create a list with non-evaluated expressions parsed as arguments. This has a somewhat-similar (but not 100% similar) effect to <code>{}</code><li><p><code>list</code> - create a list with all arguments to list function evaluated.<li><p><code>eval</code>, <code>parse</code>, <code>repr</code> - evaluate a list or single expression, parse to q-expression, convert values to strings.<li><p><code>raise_error</code>, <code>try</code>, <code>try_catch</code> - functions to use exceptions during evaluation.<li><p><code>head</code>, <code>tail</code>, <code>cons</code>, <code>push</code>, <code>pop</code>, <code>insert</code>, <code>remove</code> - list manipulation functions<li><p><code>for</code>, <code>while</code> - looping functions<li><p><code>scope</code>, <code>do</code> - do these expressions in a child scope <code>scope</code> or in current scope (<code>do</code>)<li><p><code>is_list</code>, <code>is_list</code>, <code>is_int</code>, <code>is_string</code>, <code>is_truthy</code>, <code>is_callable</code>, <code>is_nil</code>, <code>is_metamacro</code>, <code>is_module</code> - check types<li><p><code>defun</code>, <code>lambda</code> - create named and anonymous functions<li><p><code>cond</code>, <code>if</code> - conditions<li><p><code>random</code> - random number between given range<li><p><code>time</code> - unix time as number</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="macro-environments">1.5.3 Macro environments</h4><p>Inside Yaksha a root (known as <code>builtins_root</code>) environment is created. It will house builtin functions and results of executing prelude code.<p>A single <code>.yaka</code> file in imports (or current compiled file) will have their own root environment that is a child of <code>builtins_root</code>.<p>During garbage collection, mark phase will start marking from <code>builtins_root</code> and file level roots.<p>Environment is an unordered_map with string keys. Environments and maps use same data type internally.</div><div class="note"></div></div><div class="box"><div class="content"><h4 id="how-does-it-look-like">1.5.4 How does it look like</h4></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="c1"># ‚ïî‚ïê‚ïó‚îå‚îÄ‚îê‚îå‚î¨‚îê‚îå‚îÄ‚îê‚î¨‚î¨  ‚îå‚îÄ‚îê  ‚ïî‚ï¶‚ïó‚î¨‚îå‚î¨‚îê‚îå‚îÄ‚îê</span>
<span class="c1"># ‚ïë  ‚îÇ ‚îÇ‚îÇ‚îÇ‚îÇ‚îú‚îÄ‚îò‚îÇ‚îÇ  ‚îú‚î§    ‚ïë ‚îÇ‚îÇ‚îÇ‚îÇ‚îú‚î§</span>
<span class="c1"># ‚ïö‚ïê‚ïù‚îî‚îÄ‚îò‚î¥ ‚î¥‚î¥  ‚î¥‚î¥‚îÄ‚îò‚îî‚îÄ‚îò   ‚ï© ‚î¥‚î¥ ‚î¥‚îî‚îÄ‚îò</span>
<span class="c1"># ‚ïî‚ïê‚ïó‚î¨‚îå‚îÄ‚îê‚îå‚îÄ‚îê  ‚ïî‚ïó ‚î¨ ‚î¨‚îå‚îÄ‚îê‚îå‚îÄ‚îê</span>
<span class="c1"># ‚ï†‚ï£ ‚îÇ‚îå‚îÄ‚îò‚îå‚îÄ‚îò  ‚ï†‚ï©‚ïó‚îÇ ‚îÇ‚îå‚îÄ‚îò‚îå‚îÄ‚îò</span>
<span class="c1"># ‚ïö  ‚î¥‚îî‚îÄ‚îò‚îî‚îÄ‚îò  ‚ïö‚ïê‚ïù‚îî‚îÄ‚îò‚îî‚îÄ‚îò‚îî‚îÄ‚îò</span>
<span class="k">macros</span><span class="o">!</span><span class="p">{</span>
    <span class="p">(</span><span class="n">defun</span> <span class="n">to_fb</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">==</span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span> <span class="s2">&quot;&quot;</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">cond</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">15</span><span class="p">))</span> <span class="s2">&quot;FizzBuzz&quot;</span><span class="p">)</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">3</span><span class="p">))</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">)</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">5</span><span class="p">))</span> <span class="s2">&quot;Buzz&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">true</span> <span class="p">(</span><span class="n">to_string</span> <span class="n">n</span><span class="p">))</span>
        <span class="p">)))</span>
    <span class="p">(</span><span class="n">defun</span> <span class="n">fizzbuzz</span> <span class="p">()</span> <span class="p">(</span><span class="n">list</span> <span class="p">(</span><span class="n">yk_create_token</span> <span class="n">YK_TOKEN_STRING</span> <span class="p">(</span><span class="n">reduce</span> <span class="o">+</span> <span class="p">(</span><span class="n">map</span> <span class="n">to_fb</span> <span class="p">(</span><span class="n">range</span> <span class="mi">1</span> <span class="mi">101</span><span class="p">))))))</span>
    <span class="p">(</span><span class="n">yk_register</span> <span class="p">{</span><span class="n">dsl</span> <span class="n">fizzbuzz</span> <span class="n">fizzbuzz</span><span class="p">})</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">fizzbuzz</span><span class="o">!</span><span class="p">{})</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yaksha-library">2 Yaksha library</h2><span class="timestamp">Created 2022-08-18, Last Updated 2023-07-01</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Yaksha library uses multiple 3rd party libraries, set of python scripts and few other nuts and bolts to create library sources.</div><div class="note"></div></div><div class="box"><div class="content"><p>Core parts of runtime library functionality starts with <code>yk__</code> or <code>YK__</code>.<p>Yaksha programming language preserves anything that starts with <code>yk__</code> or <code>YK__</code> while prefixing any other name with <code>yy__</code>.</div><div class="note"><p>This avoids collisions with C standard library functions or keywords.</div></div><div class="box"><div class="content"><h3 id="standard-library-components">2.1 Standard Library Components</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="core-library">2.1.1 Core Library</h4><p><span class="yellow-status">in progress</span><p>Small core library with useful features.<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libs</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="ui-library">2.1.2 UI Library</h4><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Use raygui with raylib.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">raylib.gui</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="raylib-graphics-game-audio-library">2.1.3 raylib - Graphics/Game/Audio Library</h4><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Use raylib to build games and such</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">raylib</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="cl-library">2.1.4 CL Library</h4><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><p>Access to OpenCL features and parallel programming.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cl</span>

<span class="k">@device</span>
<span class="k">def</span> <span class="nf">my_program</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">dvc</span><span class="p">:</span> <span class="n">cl</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dvc</span><span class="p">,</span> <span class="n">my_program</span><span class="p">)</span>
</pre></div></div><div class="note"><p>Placeholder code, API is not designed yet.</div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="language-grammar">3 Language Grammar</h2><span class="timestamp">Created 2022-08-09, Last Updated 2023-08-05</span></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">Warning! this section needs rewriting</span></div><div class="note"></div></div><div class="box"><div class="content"><p>This describes Yaksha language grammar.<p>Lot learned from <code>Crafting Interpreters</code> book and Python grammar page.</div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><h3 id="statements">3.1 Statements</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>This section describes statements and program structure. Program is made from one or more program statements. Standard statements are what goes inside functions.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">program</span><span class="p">:</span> <span class="n">import_statement</span><span class="o">*</span> <span class="n">program_declaration</span><span class="o">*</span>
<span class="n">program_declarations</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">const_statement</span>
    <span class="o">|</span> <span class="n">struct_statement</span>
    <span class="o">|</span> <span class="n">def_statement</span>
<span class="n">standard_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">compound_statement</span>
    <span class="o">|</span> <span class="n">simple_statement</span>
<span class="n">compound_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">if_statement</span>
    <span class="o">|</span> <span class="n">while_statement</span>
<span class="n">simple_statement</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">let_statement</span>
    <span class="o">|</span> <span class="n">return_statement</span>
    <span class="o">|</span> <span class="n">defer_statement</span>
    <span class="o">|</span> <span class="s2">&quot;pass&quot;</span>
    <span class="o">|</span> <span class="s2">&quot;break&quot;</span>
    <span class="o">|</span> <span class="s2">&quot;continue&quot;</span>
    <span class="o">|</span> <span class="n">expr_statement</span>
    <span class="o">|</span> <span class="n">del_statement</span>
    <span class="o">|</span> <span class="n">c_code_statement</span>
<span class="c1"># Because defer can use del statement or any another expression.</span>
<span class="c1"># Del statement has two components with and without statement end.</span>
<span class="n">base_del_statement</span><span class="p">:</span> <span class="s2">&quot;del&quot;</span> <span class="n">expr</span>
<span class="n">del_statement</span><span class="p">:</span> <span class="n">base_del_statement</span> <span class="n">st_end</span>
<span class="c1"># Defer can use a del statement or an expr</span>
<span class="n">defer_statement</span><span class="p">:</span> <span class="s2">&quot;defer&quot;</span> <span class="p">(</span><span class="n">base_del_statement</span> <span class="o">|</span> <span class="n">expr</span><span class="p">)</span> <span class="n">st_end</span>
<span class="c1"># Functions</span>
<span class="n">def_statement</span><span class="p">:</span> <span class="n">annotation</span><span class="o">*</span> <span class="s2">&quot;def&quot;</span> <span class="n">name</span> <span class="s2">&quot;(&quot;</span> <span class="n">parameters</span><span class="err">?</span> <span class="s2">&quot;)&quot;</span> <span class="n">block</span> <span class="n">st_end</span>
<span class="c1"># Let statement creates variables</span>
<span class="n">let_statement</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">data_type</span> <span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="n">expr</span><span class="p">)</span><span class="err">?</span> <span class="n">st_end</span>
<span class="c1"># If statement</span>
<span class="n">if_statement</span><span class="p">:</span> <span class="s2">&quot;if&quot;</span> <span class="n">block</span> <span class="p">(</span><span class="s2">&quot;else&quot;</span> <span class="n">block</span><span class="p">)</span><span class="err">?</span>
<span class="c1"># While statement</span>
<span class="n">while_statement</span><span class="p">:</span> <span class="s2">&quot;while&quot;</span> <span class="n">block</span>
<span class="c1"># Custom data structures</span>
<span class="c1"># Struct value data types must be present</span>
<span class="n">struct_value</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">data_type</span> <span class="n">st_end</span>
<span class="n">struct_block</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span> <span class="n">newline</span> <span class="n">ba_indent</span> <span class="n">struct_value</span><span class="o">+</span> <span class="n">ba_dedent</span>
<span class="n">stuct_statement</span><span class="p">:</span> <span class="n">annotation</span><span class="o">*</span> <span class="s2">&quot;class&quot;</span> <span class="n">name</span> <span class="n">struct_block</span>
<span class="c1"># Expression statements, calling functions etc.</span>
<span class="n">expr_statement</span><span class="p">:</span> <span class="n">expr</span> <span class="n">st_end</span>
<span class="c1"># Return statement</span>
<span class="n">return_statement</span><span class="p">:</span> <span class="s2">&quot;return&quot;</span> <span class="n">expr</span> <span class="n">st_end</span>
<span class="c1"># Constants compiles to #defines.</span>
<span class="n">const_statement</span><span class="p">:</span> <span class="s2">&quot;const&quot;</span> <span class="n">name</span> <span class="s2">&quot;=&quot;</span> <span class="p">(</span><span class="n">number</span> <span class="o">|</span> <span class="n">string</span><span class="p">)</span>
<span class="c1"># Import statements include other source files and perform name mangling</span>
<span class="c1"># You need to always rename level 2+ imports</span>
<span class="n">import_statement</span><span class="p">:</span> <span class="s2">&quot;import&quot;</span> <span class="n">name</span> <span class="p">(</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="n">name</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;as&quot;</span> <span class="n">name</span> <span class="p">)</span><span class="err">?</span> <span class="n">st_end</span>
<span class="c1"># Dumps unmodified C code. It would be better to encapsulate these.</span>
<span class="c1"># When used with @native functions compiles to a c macro</span>
<span class="n">c_code_statement</span><span class="p">:</span> <span class="s2">&quot;ccode&quot;</span> <span class="p">(</span><span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span><span class="p">)</span> <span class="n">st_end</span>
<span class="c1"># Multiline or single simple statement blocks</span>
<span class="n">block</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span> <span class="p">(</span><span class="n">newline</span> <span class="n">ba_indent</span> <span class="n">standard_statement</span><span class="o">+</span> <span class="n">ba_dedent</span> <span class="o">|</span> <span class="n">simple_statement</span><span class="p">)</span>
</pre></div></div><div class="note"><p><code>defer</code> statement is special, it can take either a <code>del</code> statement or any expression.<p>This allows you to defer a <code>del</code>.</div></div><div class="box"><div class="content"><h3 id="data-type">3.2 Data Type</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">data_type</span><span class="p">:</span> <span class="n">data_type_part</span> <span class="o">|</span> <span class="n">name</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="n">name</span><span class="p">)</span><span class="err">?</span> <span class="p">(</span><span class="s2">&quot;[&quot;</span> <span class="n">data_type_args</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="err">?</span>
<span class="n">data_type_args</span><span class="p">:</span> <span class="n">data_type</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">data_type</span><span class="p">)</span><span class="o">*</span>
<span class="n">data_type_part</span><span class="p">:</span> <span class="n">name</span> <span class="o">|</span> <span class="n">primitive_data_type</span>
<span class="n">primitive_data_type</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;i8&quot;</span> <span class="o">|</span> <span class="s2">&quot;i16&quot;</span> <span class="o">|</span> <span class="s2">&quot;i32&quot;</span> <span class="o">|</span> <span class="s2">&quot;i64&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;u8&quot;</span> <span class="o">|</span> <span class="s2">&quot;u16&quot;</span> <span class="o">|</span> <span class="s2">&quot;u32&quot;</span> <span class="o">|</span> <span class="s2">&quot;u64&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;f32&quot;</span> <span class="o">|</span> <span class="s2">&quot;f64&quot;</span>
</pre></div></div><div class="note"><p>Data type describes, primitives, custom data types and non primitives.</div></div><div class="box"><div class="content"><h3 id="expressions">3.3 Expressions</h3></div><div class="note"></div></div><div class="box"><div class="content"><p>Expressions are itsy bitsy pieces that make up parts of statements.</div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="n">expr</span><span class="p">:</span> <span class="n">assignment</span>
<span class="n">assignment</span><span class="p">:</span> <span class="p">(</span><span class="n">fncall</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="err">?</span> <span class="n">name</span> <span class="s2">&quot;=&quot;</span> <span class="n">assignment</span>
    <span class="o">|</span> <span class="n">logical_not</span><span class="p">;</span>
<span class="n">logical_not</span><span class="p">:</span> <span class="s2">&quot;not&quot;</span> <span class="n">logic_or</span>
<span class="n">logic_or</span><span class="p">:</span> <span class="n">logic_and</span> <span class="p">(</span><span class="s2">&quot;or&quot;</span> <span class="n">logic_and</span><span class="p">)</span><span class="o">*</span>
<span class="n">logic_and</span><span class="p">:</span> <span class="n">equality</span> <span class="p">(</span><span class="s2">&quot;and&quot;</span> <span class="n">equality</span><span class="p">)</span><span class="o">*</span>
<span class="n">equality</span><span class="p">:</span> <span class="n">comparision</span> <span class="p">((</span><span class="s2">&quot;!=&quot;</span> <span class="o">|</span> <span class="s2">&quot;==&quot;</span><span class="p">)</span> <span class="n">comparision</span><span class="p">)</span><span class="o">*</span>
<span class="n">comparision</span><span class="p">:</span> <span class="n">term</span> <span class="p">((</span><span class="s2">&quot;&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">)</span> <span class="n">term</span><span class="p">)</span><span class="o">*</span>
<span class="n">term</span><span class="p">:</span> <span class="n">factor</span> <span class="p">((</span><span class="s2">&quot;-&quot;</span> <span class="o">|</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span> <span class="n">factor</span><span class="p">)</span><span class="o">*</span>
<span class="n">factor</span><span class="p">:</span> <span class="n">unary</span> <span class="p">((</span><span class="s2">&quot;/&quot;</span> <span class="o">|</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="n">unary</span><span class="p">)</span><span class="o">*</span>
<span class="n">unary</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span> <span class="n">unary</span> <span class="o">|</span> <span class="n">fncall</span>
<span class="n">fncall</span><span class="p">:</span> <span class="n">primary</span> <span class="p">(</span> <span class="s2">&quot;(&quot;</span> <span class="n">arguments</span><span class="err">?</span> <span class="s2">&quot;)&quot;</span> <span class="o">|</span> <span class="s2">&quot;[&quot;</span> <span class="n">expr</span> <span class="s2">&quot;]&quot;</span> <span class="o">|</span> <span class="s2">&quot;.&quot;</span> <span class="n">name</span> <span class="p">)</span><span class="o">*</span>
<span class="n">primary</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span> <span class="o">|</span> <span class="s2">&quot;False&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span> <span class="o">|</span> <span class="n">number</span> <span class="o">|</span> <span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span> <span class="o">|</span> <span class="n">name</span> <span class="o">|</span>
          <span class="s2">&quot;(&quot;</span> <span class="n">expr</span> <span class="s2">&quot;)&quot;</span>
</pre></div></div><div class="note"><p>Based on <a href="https://craftinginterpreters.com/appendix-i.html">lox grammar</a> and <a href="https://www.mathcs.emory.edu/~valerie/courses/fall10/155/resources/op_precedence.html">Python operator precedence</a>.</div></div><div class="box"><div class="content"><h3 id="useful-utils">3.4 Useful utils</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="c1"># Annotations are used to define types of functions or structures</span>
<span class="c1"># Currently only @device, @native and @generic annotations are available.</span>
<span class="c1"># Annotations may have a single string parameter.</span>
<span class="n">annotation</span><span class="p">:</span> <span class="s2">&quot;@&quot;</span> <span class="n">name</span> <span class="p">(</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">string</span> <span class="o">|</span> <span class="n">triple_quote_string</span> <span class="p">)</span> <span class="s2">&quot;)&quot;</span> <span class="p">)</span> <span class="n">newline</span>
<span class="n">parameters</span><span class="p">:</span> <span class="n">parameter</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">parameter</span><span class="p">)</span><span class="o">*</span>
<span class="n">parameter</span><span class="p">:</span> <span class="n">name</span> <span class="s2">&quot;:&quot;</span> <span class="n">datatype</span>
<span class="n">st_end</span><span class="p">:</span> <span class="n">newline</span> <span class="o">|</span> <span class="n">eof</span>
<span class="n">newline</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">|</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<span class="n">eof</span><span class="p">:</span> <span class="s2">&quot;end of file&quot;</span>
<span class="n">ba_indent</span><span class="p">:</span> <span class="s2">&quot;increase in indentation&quot;</span>
<span class="n">ba_dedent</span><span class="p">:</span> <span class="s2">&quot;decrease is indentation&quot;</span>
</pre></div></div><div class="note"><p><code>ba_indent</code> and <code>ba_dedent</code> gets calculated before parsing in <code>block_analyzer</code> phase.</div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="compiler-internals">4 Compiler Internals</h2><span class="timestamp">Created 2022-08-18, Last Updated 2023-08-13</span></div><div class="note"></div></div><div class="box"><div class="content"><p>This section describes how compiler works.</div><div class="note"><p>Total of <code>12+</code> passes are planned for the compiler.</div></div><div class="box"><div class="content"><h3 id="what-happens-when-you-compile-a-yaka-file">4.1 What happens when you compile a <code>.yaka</code> file?</h3><h4 id="let-s-look-at-a-sample">4.1.1 Let's look at a sample</h4></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="input-code">4.1.1.1 Input code</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="o">+</span> <span class="n">b</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="output-c-code">4.1.1.2 Output C code</h5></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="c1">// --yaksha header section--</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;yk__lib.h&quot;</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__factorial</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">);</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__main</span><span class="p">();</span>
<span class="c1">// --yaksha body section--</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__factorial</span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">yy__x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">yy__x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">yy__x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">yy__factorial</span><span class="p">((</span><span class="n">yy__x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)));</span>
<span class="p">}</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="nf">yy__main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">yy__a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">yy__b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__0</span><span class="p">);</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">yy__a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">yy__factorial</span><span class="p">(</span><span class="n">yy__a</span><span class="p">)));</span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">t__1</span><span class="p">));</span>
<span class="w">      </span><span class="n">yy__a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">yy__a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdscatsds</span><span class="p">(</span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__2</span><span class="p">),</span><span class="w"> </span><span class="n">yy__b</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">yy__b</span><span class="p">);</span>
<span class="w">      </span><span class="n">yy__b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsdup</span><span class="p">(</span><span class="n">t__3</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__3</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__2</span><span class="p">);</span>
<span class="w">      </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">yy__b</span><span class="p">));</span>
<span class="w">  </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">t__4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yk__sdsnew</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">t__4</span><span class="p">));</span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__4</span><span class="p">);</span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">t__0</span><span class="p">);</span>
<span class="w">  </span><span class="n">yk__sdsfree</span><span class="p">(</span><span class="n">yy__b</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// --yaksha footer section--</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">yy__main</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</pre></div></div><div class="note"><p>Notice <code>yk__sdsfree</code> is automatically generated for simple string uses. This makes strings immutable. Currently, it is doing a lot of unnecessary processing. üòì</div></div><div class="box"><div class="content"><h3 id="phases-of-the-compiler">4.2 Phases of the compiler</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="tokenizer">4.2.1 Tokenizer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Tokenizer breaks down input to individual tokens and Identifies Keywords.<li><p>Parse numbers and strings and check if they are valid according to the grammar.</ul></div><div class="note"><p>If any error is detected at this point we still continue up to parser so we can identify maximum number of errors.</div></div><div class="box"><div class="content"><h4 id="block-analyzer">4.2.2 Block analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Convert indentation to <code>ba_indent</code>, <code>ba_dedent</code> type tokens.<li><p>Remove comments.<li><p>Remove extra new lines.</ul></div><div class="note"><p>Only 2-spaces, 4-spaces or tab based indents are supported. Will try to guess indentation type.<p>Still continue to parser even after errors.</div></div><div class="box"><div class="content"><h4 id="parser">4.2.3 Parser</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Parses tokens returned by block analyzer an AST.<li><p>AST is represented as a <code>std::vector</code> of <code>stmt*</code>.</ul></div><div class="note"><p>Any errors from previous stages and parsing stage is printed here and program will exit.</div></div><div class="box"><div class="content"><h4 id="import-analyzer">4.2.4 Import analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><img alt="Import Analyzer"src="images/yk-imports.png"style="max-width:100%"><ul><li><p>Analyzes imports.<li><p>Parses imported files.<li><p>This step will use more instances of Tokenizer, Parser and Compiler objects.</ul><h4 id="def-struct-const-visitor">4.2.5 Def-Struct-Const Visitor</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Visit <code>def</code> statements and collect functions to a map.<li><p>Visit <code>class</code> statements and collect structures to a map.<li><p>Visit global constants.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="return-path-analyzer">4.2.6 Return path analyzer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span><ul><li><p>Analyzes return paths.<li><p>Ensure all functions return.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="type-checker">4.2.7 Type checker</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Type checker visits AST and check for invalid types.<li><p>Checks for undefined variables.<li><p>Checks for undefined functions.<li><p>Checks for undefined structures.<li><p>Check all return types are same as that of the encapsulating functions.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="template-compiler">4.2.8 Template Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Rewrite @template to be normal functions based on what's passed to them.<li><p>Rewrite <code>fncall</code> expressions to use newly created functions.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="optimizer">4.2.9 Optimizer</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Remove dead code.<li><p>Basic constant folding.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="to-cl-compiler">4.2.10 To-CL-Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span><span class="blue-status">planned for v0.5</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Convert <code>@device</code> code to OpenCL program code.<li><p>Copy necessary structures.<li><p>Check validity - no generics, no str, no allocations.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="to-c-compiler">4.2.11 To-C-Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="yellow-status">in progress</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>Writes <code>C</code> code from AST.<li><p>Do any simple optimizations.<li><p>Handle <code>defer</code> statements.<li><p>Handle <code>str</code> deletions.<li><p>Create <code>struct</code> and function declarations.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="c-to-c-compiler">4.2.12 C-To-C Compiler</h4></div><div class="note"></div></div><div class="box"><div class="content"><p><span class="red-status">not started</span></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p>We generate code to a single <code>C</code> file which can then be further optimized.<li><p>Parse and optimize subset of generated <code>C</code> code.</ul></div><div class="note"></div></div><div class="box"><div class="content"><h3 id="how-does-the-yaksha-lang-library-get-packaged">4.3 How does the Yaksha-lang library get packaged?</h3></div><div class="note"></div></div><div class="box"><div class="content"><div class="banner-image"><img alt="Yaksha Programming Language Runtime"src="images/yk-rt.png"style="max-width:100%"></div></div><div class="note"><p>Multiple sources are packaged into a single header file.<p>Library functionality is exposed by prefixing with <code>yk__</code> or <code>YK__</code>.</div></div><div class="box"><div class="content"><h4 id="packer-components">4.3.1 Packer components</h4></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>packer.py</code> - Run packer DSL scripts and create packaged single header libraries.<li><p><code>inctree.py</code> - Topological sort <code>#include</code> DAG to determine best order for combining headers.</ul><ul><li><p><code>cids.exe</code> - Use <code>stb_c_lexer.h</code> library to parse C code and extract identifiers.<li><p><code>single_header_packer.py</code> - ApoorvaJ's single header C code packager. <a href="https://github.com/ApoorvaJ/libs/blob/master/scripts/single_header_packer.py">Repo</a><li><p><code>python-patch</code> - techtonik's patch script. <a href="https://github.com:techtonik/python-patch">Repo</a><li><p><code>fcpp</code>- Frexx C Preprocessor by Daniel Stenberg. (Patch for Windows compilation was needed, failed to compile with MSVC, works with MingW with patch).</ul></div><div class="note"><p>DAG - Directed Acyclic Graph.</div></div><div class="box"><div class="content"><h4 id="third-party-libraries">4.3.2 Third Party Libraries</h4></div><div class="note"></div></div><div class="box"><div class="content"><ul><li><p><code>sds</code> - Salvatore Sanfilippo's string library. (Needed a patch to support MSVC 2019)<li><p><code>stb</code> - Single header libraries by Sean Barrett.<li><p><code>libs</code> - Mattias Gustavsson's single header C libraries.<li><p><code>utf8proc</code> - UTF-8 library - Jan Behrens, Public Software Group and Julia developers.</ul></div><div class="note"><p>If you stack few giants, you can stand very tall on top of them.</p><br><p>Note - currently only sds and stb_ds is used. This selection of libraries may change.</div></div><div class="box"><div class="content"><h4 id="packer-dsl">4.3.3 Packer DSL</h4></div><div class="note"></div></div><div class="box"><div class="content"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">use_source</span><span class="p">(</span><span class="s2">&quot;libs&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ini&quot;</span><span class="p">,</span> <span class="s2">&quot;thread&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">]:</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">extract_ids</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ids</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lib</span><span class="p">)]</span>
    <span class="n">PU</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ids</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
    <span class="n">prefix</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">prefix</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX_U</span><span class="p">,</span> <span class="n">PU</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;yk__http://&#39;</span><span class="p">),</span> <span class="s1">&#39;http://&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s2">&quot;YK__THREAD_PRIORITY_HIGHEST&quot;</span><span class="p">,</span> <span class="s2">&quot;THREAD_PRIORITY_HIGHEST&quot;</span><span class="p">]])</span>
    <span class="n">copy_file</span><span class="p">(</span><span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">PREFIX</span> <span class="o">+</span> <span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">is_temp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">clang_format</span><span class="p">(</span><span class="n">PREFIX</span> <span class="o">+</span> <span class="n">lib</span> <span class="o">+</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="n">is_temp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div></div><div class="note"><p>It is just Python 3.x with extra functions added and evaluated.ü§´</div></div></div></div><script>!function(){const e=document.querySelector("#btn-toggle");var t=document.querySelector("#btn-small-font"),s=document.querySelector("#btn-medium-font"),n=document.querySelector("#btn-large-font");const a=document.querySelector("#theme-link"),l=document.querySelector("#font-size-link"),o="jadogg.github.io/theme",i="jadogg.github.io/font",c='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-brightness-high" viewBox="0 0 16 16">\n  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>\n</svg>',r='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">\n  <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>\n</svg>';var m=localStorage.getItem(o),g=localStorage.getItem(i);"/assets/style.min.css"!==m&&"/assets/style.light.min.css"!==m||(a.href=m,e.innerHTML="/assets/style.min.css"===m?c:r),"/assets/large-font.min.css"!=g&&"/assets/medium-font.min.css"!=g&&"/assets/small-font.min.css"!=g||(l.href=g),e.addEventListener("click",function(){"/assets/style.min.css"===a.getAttribute("href")?(a.href="/assets/style.light.min.css",localStorage.setItem(o,"/assets/style.light.min.css"),e.innerHTML=r):(a.href="/assets/style.min.css",localStorage.setItem(o,"/assets/style.min.css"),e.innerHTML=c)}),t.addEventListener("click",function(){l.href="/assets/small-font.min.css",localStorage.setItem(i,"/assets/small-font.min.css")}),s.addEventListener("click",function(){l.href="/assets/medium-font.min.css",localStorage.setItem(i,"/assets/medium-font.min.css")}),n.addEventListener("click",function(){l.href="/assets/large-font.min.css",localStorage.setItem(i,"/assets/large-font.min.css")}),document.body.querySelectorAll("details").forEach(e=>{e.hasAttribute("open")?e.removeAttribute("open"):e.setAttribute("open",!0),console.log(e.hasAttribute("open"))})}()</script>